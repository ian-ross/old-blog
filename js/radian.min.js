var radian=angular.module("radian",[]);radian.factory("processAttrs",["radianEval",function(e){"use strict";return function(t,n){t.$$radianVars={},Object.keys(n).forEach(function(r){if(r=="id"||r=="class"||r.charAt(0)=="$"||r.search(/^ng[A-Z]/)!=-1)return;var i=e(t,n[r],!0,!0);t.$$radianVars[r]={fvs:i[1],expr:n[r]},t[r]=i[0];var s=t.$$radianVars[r];s.fvwatchers={},s.fvs.forEach(function(n){s.fvwatchers[n]=t.$watch(n,function(n,i){t[r]=e(t,s.expr)},!0)}),n.$observe(r,function(n){s.expr=n;try{var i=e(t,n,!0);t[r]=i[0],s.fvs=i[1],Object.keys(s.fvwatchers).forEach(function(e){s.fvs.indexOf(e)==-1&&(s.fvwatchers[e](),delete s.fvwatchers[e])}),s.fvs.forEach(function(n){s.fvwatchers[n]||(s.fvwatchers[n]=t.$watch(n,function(){t[r]=e(t,s.expr)},!0))})}catch(o){console.log("Exception in radianEval watcher.  Skipping...")}})})}}]),radian.factory("calcPlotDimensions",function(){return function(e,t,n){var r=!1,i=300,s=1.618,o=s*i,u=n.width,a=n.height,f=n.aspect,l=t.parent().width(),c=t.parent().height();e.parentWidth=l,e.parentHeight=c;var h=t.width(),p=t.height(),d=t.css("aspect")?parseFloat(t.css("aspect")):null;if(u){var v=u.toString();v.charAt(v.length-1)=="%"&&(r=!0,u=l*Number(v.slice(0,v.length-1))/100)}if(a){var m=a.toString();m.charAt(m.length-1)=="%"&&(r=!0,a=c*Number(m.slice(0,m.length-1))/100)}return u&&a&&f||a&&u?(i=a,o=u,s=o/i):a&&f?(i=a,s=f,o=i*s):u&&f?(o=u,s=f,i=o/s):a?(i=a,h?(o=h,s=o/i):d?(s=d,o=i*s):o=i*s):u?(o=u,p?(i=p,s=o/i):d?(s=d,i=o/s):i=o/s):f?(s=f,h?(o=h,i=o/s):p?(i=p,o=i*s):o=i*s):p&&h?(i=p,o=h,s=o/i):p&&d?(i=p,s=d,o=i*s):h&&d?(o=h,s=d,i=o/s):p?(i=p,o=i*s):h?(o=h,i=o/s):d&&(s=d,i=o/s),e.pxwidth=Number(o),e.pxheight=Number(i),r}}),radian.directive("plot",["processAttrs","calcPlotDimensions","addToLayout","$timeout","$rootScope","dumpScope","dft","plotLib",function(e,t,n,r,i,s,o,u){"use strict";function f(s,o,u,f){function l(e,t){return e==t?!0:t==i?!1:l(e,t.$parent)}s.watchParentSize=function(e){function t(){var e=o.parent().width(),n=o.parent().height();(e!=s.parentWidth||n!=s.parentHeight)&&s.windowResize(s,o),s.parentWatchTimeout=r(t,500)}!e&&s.parentWatchTimeout?(r.cancel(s.parentWatchTimeout),s.parentWatchTimeout=null):e&&!s.parentWatchTimeout&&(s.parentWatchTimeout=r(t,500),s.$on("$destroy",function(){r.cancel(s.parentWatchTimeout)}))},e(s,u),s.plotid=++a,s.uielems=o.children()[1],s.sizeAttrs={width:u.width,height:u.height,aspect:u.aspect},s.inLayout||(s.layoutTop=!0,s.inStack||s.watchParentSize(t(s,o,s.sizeAttrs)),$(o).css("width",s.pxwidth).css("height",s.pxheight),s.topLevel=o[0],s.svg=o.children()[0]),(s.inLayout||s.inStack)&&n(s,s,s.layoutShare,o),u.hasOwnProperty("strokeSwitch")&&(s.strokesel=0),s.fontSize=Number(u.fontSize)||12,s.titleFontSize=1.25*s.fontSize,u.titleFontSize&&(u.titleFontSize.indexOf("%")!=-1?s.titleFontSize=parseFloat(u.titleFontSize)/100*s.fontSize:u.titleFontSize.indexOf(".")!=-1?s.titleFontSize=Number(u.titleFontSize)*s.fontSize:s.titleFontSize=Number(u.titleFontSize)||1.25*s.fontSize),s.fontFamily=u.fontFamily||null,s.fontStyle=u.fontStyle||null,s.fontWeight=u.fontWeight||null,s.fontVariant=u.fontVariant||null,s.titleFontFamily=u.titleFontFamily||s.fontFamily,s.titleFontStyle=u.titleFontStyle||s.fontStyle,s.titleFontWeight=u.titleFontWeight||"bold",s.titleFontVariant=u.titleFontVariant||s.fontVariant,s.views=[],s.nplots=0,s.switchable=[],s.addPlot=function(e){++s.nplots,s.hasOwnProperty("legendSwitches")&&s.switchable.push(e),e.enabled=!0,s.$emit("dataChange"),e.$on("$destroy",function(t){if(l(t.targetScope,e)){--s.nplots,e.enabled=!1;var n=s.switchable.indexOf(e);n!=-1&&s.switchable.splice(n,1),s.$emit("dataChange")}})},f(s.$new(),function(e){o.append(e)})}function l(e,n){function o(){e.views.forEach(function(t){S(t,e)})}function u(t){e.rangeXExtendPixels=[0,0],e.rangeYExtendPixels=[0,0],e.$broadcast("setupExtra"),e.views=i.map(function(n,r){return n.selectAll(".radian-plot").remove(),g(e,n,r,i.length,t)}),e.$broadcast("setupExtraAfter"),s&&s(),o()}function a(t,n){var r="axis"+t.toUpperCase()+"Transform",i=t.toLowerCase()+"range",s="save"+t.toUpperCase()+"Range",o=!1;e.hasOwnProperty(s)&&(e[i]=e[s],delete e[s],o=!0);switch(n){case"linear":e[r]="linear";break;case"log":e[r]="log";break;case"linear-0":e[r]="linear",e[s]=angular.copy(e[i]),e[i]?e[i][0]=0:e[i]=[0,null],o=!0;break;default:throw Error("invalid axis type transition")}o&&u(!0)}function f(e,t){a("y",t)}function l(e,t){a("x",t)}function c(t){$(e.topLevel).css("width",e.pxwidth).css("height",e.pxheight);var n=d3.select(e.svg);n.attr("width",e.pxwidth).attr("height",e.pxheight);var r;t?r=n.append("g"):r=i[0],r.attr("width",e.pxwidth).attr("height",e.pxheight),$(e.uielems).width(e.pxwidth+"px").height(e.pxheight+"px"),t&&(i=[r]);if(!e.sizeviewgroup){var o=e;if(e.inStack)while(!o.hasOwnProperty("inStack"))o=o.$parent;o.sizeviewgroup=r}e.uivisible=!1;if(e.hasOwnProperty("zoomX")){var u=e.zoomX==""?.2:+e.zoomX;u=Math.min(.95,Math.max(.05,u));var a=(e.pxheight-6)*u,f=(e.pxheight-6)*(1-u),l;t?(l=n.append("g").classed("radian-zoom-x",!0),l.zoomer=!0,i.push(l)):l=i[1],l.attr("transform","translate(0,"+(f+6)+")").attr("width",e.pxwidth).attr("height",a),r.attr("height",f),$(e.uielems).width(e.pxwidth+"px").height(f+"px"),s=function(){var t=d3.svg.brush().x(e.views[1].x);t.on("brush",function(){e.views[0].x.domain(t.empty()?e.views[1].x.domain():t.extent()),S(e.views[0],e)}),e.views[1].post=function(n){e.brushgroup=n.append("g").attr("class","x brush").call(t).selectAll("rect").attr("y",-6),e.brushgroup.attr("height",e.views[1].realheight+7)}}}}e.topelem=n,e.inLayout?$(n.children()[0]).remove():$(window).resize(function(){e.windowResize(e,n)});var i=[],s=null;e.rangeExtendPixels=function(t,n){t!=null&&(e.rangeXExtendPixels=[Math.max(e.rangeXExtendPixels[0],t[0]),Math.max(e.rangeXExtendPixels[1],t[1])]),n!=null&&(e.rangeYExtendPixels=[Math.max(e.rangeYExtendPixels[0],n[0]),Math.max(e.rangeYExtendPixels[1],n[1])])},e.windowResize=function(e,n){(!e.inLayout||e.layoutTop)&&e.watchParentSize(t(e,n,e.sizeAttrs)),c(!1),u()},e.hasOwnProperty("uiAxisYTransform")&&(e.yAxisSwitchEnabled=!0),e.hasOwnProperty("uiAxisXTransform")&&(e.xAxisSwitchEnabled=!0),e.hasOwnProperty("uiHistogramBins")&&(e.histogramSwitchEnabled=!0,e.histogramBinsVar=e.uiHistogramBins),e.hasOwnProperty("strokeSwitch")&&(e.strokeSwitchEnabled=!0),e.hasOwnProperty("legendSwitches")&&(e.legendEnabled=!0),r(function(){c(!0),u(),e.hasOwnProperty("uiAxisYTransform")&&e.$on("yAxisChange",f),e.hasOwnProperty("uiAxisXTransform")&&e.$on("xAxisChange",l),e.$watch("axisYTransform",function(e,t){if(e==undefined||e==t)return;u()}),e.$watch("axisXTransform",function(e,t){if(e==undefined||e==t)return;u()}),e.$on("paintChange",o),e.$on("dataChange",u),e.$watch("strokesel",function(e,t){e!=undefined&&o()}),e.$watch("xidx",function(e,t){e!=undefined&&e!=t&&u()}),e.$watch("yidx",function(e,t){e!=undefined&&e!=t&&u()})},0)}function c(e,t,n,r,i,s,o,u,a,f){if(e.hasOwnProperty(t)||e.hasOwnProperty(n)||e.hasOwnProperty(r)){var l,c;if(e.hasOwnProperty(t)){var h=e[t].split(";");h.length==2&&(l=h[0],c=h[1])}e.hasOwnProperty(n)&&(l=e[n]),e.hasOwnProperty(r)&&(c=e[r]);if(l){var p=l.split(","),d=p.map(parseFloat),v=!1,m=null;p.length==2&&p[0]&&p[1]?!isNaN(d[0])&&!isNaN(d[1])&&(v=!0,m=[d[0],d[1]],e[i]=!0,e[s]=m):p.length==1||p.length==2&&!p[1]?isNaN(d[0])||(v=!0,m=[d[0],null]):p.length==2&&!p[0]&&(isNaN(d[1])||(v=!0,m=[null,d[1]])),v&&(e[o]=m)}if(c){var g=c.split(","),d=g.map(parseFloat),v=!1,m=null;g.length==2&&g[0]&&g[1]?!isNaN(d[0])&&!isNaN(d[1])&&(v=!0,m=[d[0],d[1]],e[u]=!0,e[a]=m):g.length==1||g.length==2&&!g[1]?isNaN(d[0])||(v=!0,m=[d[0],null]):g.length==2&&!g[0]&&(isNaN(d[1])||(v=!0,m=[null,d[1]])),v&&(e[f]=m)}}}function h(e,t,n,r,i){var s=e.axisXTransform||"linear",o=e.rangeXExtendPixels,a=o?o[0]:0,f=t.realwidth-(o?o[1]:0);if(r){var l=null;e.orderX?l=e.orderX.split(/ *; */):i&&(l=i.split(/ *; */)),l&&(r=l.map(function(e){var t=e.split(/ *, */);return t.length==1?e:t})),t.x=d3.scale.linear().range([a,f]).domain([.5,r.length+.5]);var c;if(r[0]instanceof Array){var h=r[0].length,p=new Array(h);for(var d=0;d<h;++d)p[d]=u.unique(r.map(function(e){return e[d]})).length;var v=new Array(h);v[h-1]=1;for(var d=h-1;d>0;--d)v[d-1]=v[d]*p[d];if(e.groupX){var m=e.groupX%h,g=e.groupXDelta||1.25;for(var d=0;d<m;++d)v[d]*=g}c=new Array(r.length);var y=new Array(h);for(var d=0;d<r.length;++d){var b=d;for(var w=h-1;w>=0;--w)y[w]=b%p[w],b=Math.floor(b/p[w]);c[d]=0;for(var w=0;w<h;++w)c[d]+=y[w]*v[w]}var E=c[r.length-1]/(r.length-1);for(var d=0;d<r.length;++d)c[d]=c[d]/E+1}t.x.oton=function(e){if(e instanceof Array){for(var t=0;t<r.length;++t)if(r[t].every(function(t,n){return t==e[n]}))return c[t];throw Error("Discrete value mismatch!")}return r.indexOf(e)+1},t.x.discrete=r}else n?t.x=d3.time.scale().range([a,f]).domain(e.xextent):s=="log"?t.x=d3.scale.log().range([a,f]).domain(e.xextent):t.x=d3.scale.linear().range([a,f]).domain(e.xextent),t.x.oton=function(e){return e}}function p(e,t,n,r,i){var s=e.axisXTransform||"linear",o=e.rangeXExtendPixels,a=o?o[0]:0,f=t.realwidth-(o?o[1]:0);if(r){var l=null;e.orderX2?l=e.orderX2.split(/ *; */):i&&(l=i.split(/ *; */)),l&&(r=l.map(function(e){var t=e.split(/ *, */);return t.length==1?e:t})),t.x2=d3.scale.linear().range([a,f]).domain([.5,r.length+.5]);var c;if(r[0]instanceof Array){var h=r[0].length,p=new Array(h);for(var d=0;d<h;++d)p[d]=u.unique(r.map(function(e){return e[d]})).length;var v=new Array(h);v[h-1]=1;for(var d=h-1;d>0;--d)v[d-1]=v[d]*p[d];if(e.groupX){var m=e.groupX2%h,g=e.groupX2Delta||1.25;for(var d=0;d<m;++d)v[d]*=g}c=new Array(r.length);var y=new Array(h);for(var d=0;d<r.length;++d){var b=d;for(var w=h-1;w>=0;--w)y[w]=b%p[w],b=Math.floor(b/p[w]);c[d]=0;for(var w=0;w<h;++w)c[d]+=y[w]*v[w]}var E=c[r.length-1]/(r.length-1);for(var d=0;d<r.length;++d)c[d]=c[d]/E+1}t.x2.oton=function(e){if(e instanceof Array){for(var t=0;t<r.length;++t)if(r[t].every(function(t,n){return t==e[n]}))return c[t];throw Error("Discrete value mismatch!")}return r.indexOf(e)+1},t.x2.discrete=r,t.x2.discmap=function(e){return r.indexOf(e)+1}}else n?t.x2=d3.time.scale().range([a,f]).domain(e.x2extent):s=="log"?t.x2=d3.scale.log().range([a,f]).domain(e.x2extent):t.x2=d3.scale.linear().range([a,f]).domain(e.x2extent)}function d(e,t){var n=e.axisYTransform||"linear",r=e.rangeYExtendPixels,i=r?r[0]:0,s=t.realheight-(r?r[1]:0);n=="log"?t.y=d3.scale.log().range([s,i]).domain(e.yextent):t.y=d3.scale.linear().range([s,i]).domain(e.yextent)}function v(e,t){var n=e.axisYTransform||"linear",r=e.rangeYExtendPixels,i=r?r[0]:0,s=t.realheight-(r?r[1]:0);n=="log"?t.y2=d3.scale.log().range([s,i]).domain(e.y2extent):t.y2=d3.scale.linear().range([s,i]).domain(e.y2extent)}function m(e){function t(t){e.$apply("uivisible = true")}function n(t){var n=$(t.relatedTarget),r=$(e.uielems),i=!0;while(n[0]&&n[0].parentElement){if(n[0]==r[0]){i=!1;break}n=n.parent()}i&&e.$apply("uivisible = false")}$(e.uielems).mouseenter(t).mouseleave(n)}function g(e,t,n,r,i){function f(e){return typeof e[0]=="string"?[.5,u.unique(e).length+.5]:d3.extent(e)}function l(e){return e[0]instanceof Array?d3.merge(e.map(function(e){return f(e)})):f(e)}function g(e,t,n,r){return e[0]instanceof Array?d3.merge(e.map(function(e){return d3.extent(e.filter(function(e,i){return t[i]>=n&&t[i]<=r}))})):d3.extent(e.filter(function(e,i){return t[i]>=n&&t[i]<=r}))}function G(t,n,r,i,s){var u=null;if(!t){o(e,function(e){t||e[n]&&e[n].metadata&&e[n].metadata.label&&(t=e[n].metadata.label,e[n].metadata.units&&(t+=" ("+e[n].metadata.units+")")),u=u||e[r]});if(!t&&e[i]){var a=e[i].split(",");t=a[u]}t||(t=s)}return t}var s=t.append("g").classed("radian-plot",!0),a={group:t,plotgroup:s};t.hasOwnProperty("zoomer")?a.noTitle=!0:m(e),i||(c(e,"range","rangeX","rangeY","fixedXRange","xextent","xrange","fixedYRange","yextent","yrange"),c(e,"range2","rangeX2","rangeY2","fixedX2Range","x2extent","x2range","fixedY2Range","y2extent","y2range"),e.axisYTransform=="linear-0"&&(e.hasOwnProperty("saveYRange")||(e.saveYRange=angular.copy(e.yrange)),e.yrange?e.yrange[0]=0:e.yrange=[0,null]),e.axisXTransform=="linear-0"&&(e.hasOwnProperty("saveXRange")||(e.saveXRange=angular.copy(e.xrange)),e.xrange?e.xrange[0]=0:e.xrange=[0,null]),e.$broadcast("setupRanges",e));var y=[],b=[],w=!1,E=!1,S=!1,x=null,T=null,N=[0,0],C=[0,0],k=[],L=[],A=!1,O=!1,M=!1,_=null,D=null;o(e,function(t){!e.fixedXRange&&t.enabled&&t.x&&(y=y.concat(l(t.x))),!e.fixedX2Range&&t.enabled&&t.x2&&(k=k.concat(l(t.x2))),!e.fixedYRange&&t.enabled&&t.y&&(e.fixedXRange?b=b.concat(g(t.y,t.x,e.xextent[0],e.xextent[1])):b=b.concat(l(t.y))),!e.fixedY2Range&&t.enabled&&t.y2&&(e.fixedXRange?L=L.concat(g(t.y2,t.x,e.xextent[0],e.xextent[1])):L=L.concat(l(t.y2))),t.x&&t.x.metadata&&t.x.metadata.format=="date"&&(w=!0);if(t.x&&t.x instanceof Array)if(typeof t.x[0]=="string"||t.x[0]instanceof Array||t.discreteX){var n=u.unique(t.x);n.sort();if(x){if(x.length!=n.length||x.some(function(e,t){return e instanceof Array?e.some(function(e,r){return e!=n[t][r]}):e!=n[t]}))throw Error("Incompatible discrete X values")}else x=n;t.x.metadata&&t.x.metadata.categoryOrder&&(T=t.x.metadata.categoryOrder),E=!0}else S=!0;t.x2&&t.x2.metadata&&t.x2.metadata.format=="date"&&(A=!0);if(t.x2&&t.x2 instanceof Array)if(typeof t.x2[0]=="string"||t.x2[0]instanceof Array||t.discreteX2){var n=u.unique(t.x2);n.sort();if(_){if(_.length!=n.length||_.some(function(e,t){return e instanceof Array?e.some(function(e,r){return e!=n[t][r]}):e!=n[t]}))throw Error("Incompatible discrete X2 values")}else _=n;t.x2.metadata&&t.x2.metadata.categoryOrder&&(D=t.x2.metadata.categoryOrder),O=!0}else M=!0;t.rangeXExtend&&(N[0]=Math.max(N[0],t.rangeXExtend[0]),N[1]=Math.max(N[1],t.rangeXExtend[1])),t.rangeYExtend&&(C[0]=Math.max(C[0],t.rangeYExtend[0]),C[1]=Math.max(C[1],t.rangeYExtend[1])),t.rangeXExtendPixels&&(e.rangeXExtendPixels=t.rangeXExtendPixels),t.rangeYExtendPixels&&(e.rangeYExtendPixels=t.rangeYExtendPixels)});if(E&&S)throw Error("Can't mix discrete and continuous X values");if(O&&M)throw Error("Can't mix discrete and continuous X2 values");!e.fixedXRange&&y.length>0&&(e.xextent=d3.extent(y),e.xrange&&(e.xrange[0]!=null&&(e.xextent[0]=Math.min(e.xextent[0],e.xrange[0])),e.xrange[1]!=null&&(e.xextent[1]=Math.max(e.xextent[1],e.xrange[1]))),w||(e.xextent[0]-=N[0],e.xextent[1]+=N[1])),!e.fixedYRange&&b.length>0&&(e.yextent=d3.extent(b),e.yrange&&(e.yrange[0]!=null&&(e.yextent[0]=e.yrange[0]),e.yrange[1]!=null&&(e.yextent[1]=e.yrange[1])),e.yextent[0]-=C[0],e.yextent[1]+=C[1]),!e.fixedX2Range&&k.length>0&&(e.x2extent=d3.extent(k),e.x2range&&(e.x2range[0]!=null&&(e.x2extent[0]=Math.min(e.x2extent[0],e.x2range[0])),e.x2range[1]!=null&&(e.x2extent[1]=Math.max(e.x2extent[1],e.x2range[1])))),!e.fixedY2Range&&L.length>0&&(e.y2extent=d3.extent(L),e.y2range&&(e.y2range[0]!=null&&(e.y2extent[0]=Math.min(e.y2extent[0],e.y2range[0])),e.y2range[1]!=null&&(e.y2extent[1]=Math.max(e.y2extent[1],e.y2range[1])))),a.xaxis=!e.axisX||e.axisX!="off",a.yaxis=!e.axisY||e.axisY!="off",a.x2axis=!!e.x2extent&&(!e.axisX2||e.axisX2!="off"),a.y2axis=!!e.y2extent&&(!e.axisY2||e.axisY2!="off");var P=(r==1||r==2&&n==1)&&(!e.axisXLabel||e.axisXLabel!="off"),H=!e.axisYLabel||e.axisYLabel!="off",B=(r==1||r==2&&n==1)&&(!e.axisX2Label||e.axisX2Label!="off"),j=!e.axisY2Label||e.axisY2Label!="off";a.margin={top:+e.topMargin||2,right:+e.rightMargin||2,bottom:+e.bottomMargin||2,left:+e.leftMargin||2},a.margin.top+=.5*e.fontSize,a.title=e.title,e.inStack&&(a.noTitle=!0);var F=15,I=F+ +e.fontSize,q=5+ +e.fontSize,R=Math.floor(2.5*e.fontSize);a.xaxis&&(a.margin.bottom+=I+(P?q:0)),a.x2axis&&(a.margin.top+=I+(B?q:0)),a.title&&!a.noTitle&&(a.margin.top+=R),a.realheight=a.group.attr("height")-a.margin.top-a.margin.bottom,a.outh=a.realheight+a.margin.top+a.margin.bottom,e.yextent&&d(e,a),e.y2extent&&v(e,a);var U=R,z=R;if(a.yaxis&&a.y){var W=a.y.copy(),X=e.axisYFormat?d3.format(e.axisYFormat):null,V;e.axisYTicks?e.axisYTicks instanceof Array?V=e.axisYTicks.length:V=e.axisYTicks:V=a.group.attr("height")/36;var $=X?W.tickFormat(V,X):W.tickFormat(V),J="";W.ticks(V).map($).forEach(function(e){e.length>J.length&&(J=e)}),J=J.replace(/[0-9]/g,"0");var K=e.sizeviewgroup.append("g").attr("visibility","hidden"),Q=K.append("text").attr("x",0).attr("y",0).style("font-size",e.fontSize).text(J);U=Math.max(R,F+Q[0][0].getBBox().width),K.remove()}if(a.y2axis&&a.y2){var W=a.y2.copy(),X=e.axisY2Format?d3.format(e.axisY2Format):null,V;e.axisY2Ticks?e.axisY2Ticks instanceof Array?V=e.axisY2Ticks.length:V=e.axisY2Ticks:V=a.group.attr("height")/36;var $=X?W.tickFormat(V,X):W.tickFormat(V),J="";W.ticks(V).map($).forEach(function(e){e.length>J.length&&(J=e)}),J=J.replace(/[0-9]/g,"0");var Q=e.sizeviewgroup.append("g").attr("visibility","hidden").append("text").attr("x",0).attr("y",0).style("font-size",e.fontSize).text(J);z=Math.max(R,F+Q[0][0].getBBox().width),Q.remove()}a.yaxis&&(a.margin.left+=U+(H?q:0)),a.y2axis&&(a.margin.right+=z+(j?q:0)),a.realwidth=a.group.attr("width")-a.margin.left-a.margin.right,a.outw=a.realwidth+a.margin.left+a.margin.right,e.xextent&&h(e,a,w,x,T),e.x2extent&&p(e,a,A,_,D),P&&(a.xlabel=G(e.axisXLabel,"x","xidx","selectX","X Axis")),H&&(a.ylabel=G(e.axisYLabel,"y","yidx","selectY","Y Axis")),B&&(a.x2label=G(e.axisX2Label,"x2","xidx","selectX2","X2 Axis")),j&&(a.y2label=G(e.axisY2Label,"y2","yidx","selectY2","Y2 Axis"));if(n==0){var Y=d3.select(e.svg);a.clip="mainclip"+e.plotid,Y.select("#"+a.clip).remove(),Y.append("defs").append("clipPath").attr("id",a.clip).append("rect").attr("width",a.realwidth).attr("height",a.realheight)}return a}function y(e,t){t.fontFamily&&e.style("font-family",t.fontFamily),t.fontStyle&&e.style("font-style",t.fontStyle),t.fontWeight&&e.style("font-weight",t.fontWeight),t.fontVariant&&e.style("font-variant",t.fontVariant)}function b(e,t,n){if(e&&e=="log")return d3.format(".0e");var r=t.domain(),i=r[1]-r[0],s=Math.pow(10,Math.floor(Math.log(i/n)/Math.LN10)),o=n/i*s;o<=.15?s*=10:o<=.35?s*=5:o<=.75&&(s*=2);var u=Math.max(0,-Math.floor(Math.log(s)/Math.LN10+.01));return d3.format(u>6?".2e":",."+u+"f")}function w(e,t,n,r){var i;switch(n){case"x":i="bottom";break;case"x2":i="top";break;case"y":i="left";break;case"y2":i="right"}var s=d3.svg.axis().scale(t[n]).orient(i),u=n.toUpperCase(),a="axis"+u+"TickPadding",f=e[a]?e[a]:e.tickPadding,l=0;f&&(s.tickPadding(+f),l=+f-3);var c="axis"+u+"TickSize",h="axis"+u+"MinorTickSize",p="axis"+u+"EndTickSize",d="axis"+u+"TickSizes",v=6,m=6,g=6;if(e.tickSizes){var y=e.tickSizes.split(/ *, */);y.length>=3?(v=y[0],m=y[1],g=y[2]):y.length==2?(v=m=y[0],g=y[1]):y.length==1&&(v=m=g=y[0])}e.tickSize&&(v=e.tickSize),e.minorTickSize&&(m=e.minorTickSize),e.endTickSize&&(g=e.endTickSize);if(e[d]){var y=e[d].split(/ *, */);y.length>=3?(v=y[0],m=y[1],g=y[2]):y.length==2?(v=m=y[0],g=y[1]):y.length==1&&(v=m=g=y[0])}e[c]&&(v=e[c]),e[h]&&(m=e[h]),e[p]&&(g=e[p]),t[n].discrete&&(g=0),s.tickSize(v,m,g);if(t[n].discrete){var w=[],E=[];return t[n].discrete.forEach(function(e,r){w.push(t[n].oton(e)),E.push(e)}),s.tickValues(w),s.tickFormat(function(e){var t=w.indexOf(e);return e==-1?"":E[t]}),s.tickSize(),[s,l]}var S="%Y-%m-%d",x=!1;o(e,function(e){var t=e[n];t&&t.metadata&&t.metadata.format=="date"&&(t.metadata.dateFormat&&(S=t.metadata.dateFormat),x=!0)});var T="axis"+u+"Ticks",N="axis"+u+"Format",C="axis"+u+"Transform",k,L;k=e[T]?e[T]:r;var A=!1,O=!1,w=[],E=[];k instanceof Array&&(A=!0,k.forEach(function(e){e instanceof Array?(w.push(e[0]),E.push(e[1]),O=!0):(w.push(e),E.push(e))}),k=100*k.length),x?L=d3.time.format(e[N]?e[N]:S):L=e[N]?d3.format(e[N]):b(e[C],t[n],k);if(A)s.tickValues(w),O?s.tickFormat(function(e){var t=w.indexOf(e);return e==-1?"":E[t]}):s.tickFormat(L);else if(x){var M=null,_=k;if(isNaN(Number(k))){_=parseFloat(k);var D="";for(var P=k.length-1;P>=0;--P)if("0123456789.".indexOf(k.charAt(P))!=-1){D=k.substr(P+1);break}switch(D){case"s":M=d3.time.seconds;break;case"min":M=d3.time.minutes;break;case"hr":M=d3.time.hours;break;case"d":M=d3.time.days;break;case"week":M=d3.time.weeks;break;case"mon":M=d3.time.months;break;case"year":M=d3.time.years}}M?s.ticks(M,_):s.ticks(_),s.tickFormat(L)}else e[N]||e[C]?s.ticks(k,L):(s.ticks(k),s.tickFormat(L));var H="axis"+u+"MinorTicks",B=e[H]?e[H]:e.minorTicks;return B&&s.tickSubdivide(B),[s,l]}function E(e,t,n){var r=n?parseFloat(n):.05,i=[];isNaN(r)&&(r=.1),e.forEach(function(e){i.push((Math.random()*2-1)*r)});var s=function(e,n){return t(e+i[n])};return s.oton=t.oton,s}function S(e,t){$(e.plotgroup[0]).empty(),e.plotgroup.attr("width",e.outw).attr("height",e.outh),e.innergroup=e.plotgroup.append("g").attr("width",e.realwidth).attr("height",e.realheight).attr("transform","translate("+e.margin.left+","+e.margin.top+")"),e.clip&&e.innergroup.attr("clip-path","url(#"+e.clip+")");var n=Math.floor(t.fontSize/3),r=Math.floor(3*t.fontSize);if(e.xaxis&&e.x){var i=w(t,e,"x",e.plotgroup.attr("width")/100),s=i[0],u=i[1];e.plotgroup.append("g").attr("class","axis").style("font-size",t.fontSize).attr("transform","translate("+e.margin.left+","+(+e.realheight+e.margin.top+n)+")").call(s);if(e.xlabel){var a=e.plotgroup.append("g").attr("class","axis-label").attr("transform","translate("+(+e.margin.left+e.realwidth/2)+","+(+e.realheight+e.margin.top)+")").append("text").attr("x",0).attr("y",r+u).style("font-size",t.fontSize).attr("text-anchor","middle").text(e.xlabel);y(a,t)}}if(e.x2axis&&e.x2){var i=w(t,e,"x2",e.plotgroup.attr("width")/100),s=i[0],u=i[1];e.plotgroup.append("g").attr("class","axis").style("font-size",t.fontSize).attr("transform","translate("+e.margin.left+","+(+e.margin.top+n)+")").call(s);if(e.x2label){var a=e.plotgroup.append("g").attr("class","axis-label").attr("transform","translate("+(+e.margin.left+e.realwidth/2)+","+ +e.margin.top+")").append("text").attr("x",0).attr("y",r-u).style("font-size",t.fontSize).attr("text-anchor","middle").text(e.x2label);y(a,t)}}if(e.yaxis&&e.y){var i=w(t,e,"y",e.plotgroup.attr("height")/36),s=i[0],u=i[1];e.plotgroup.append("g").attr("class","axis").style("font-size",t.fontSize).attr("transform","translate("+(+e.margin.left-n)+","+ +e.margin.top+")").call(s);if(e.ylabel){var f=+t.fontSize,l=+e.margin.top+e.realheight/2,a=e.plotgroup.append("g").attr("class","axis-label").append("text").attr("x",f-u).attr("y",l).attr("transform","rotate(-90,"+f+","+l+")").style("font-size",t.fontSize).attr("text-anchor","middle").text(e.ylabel);y(a,t)}}if(e.y2axis&&e.y2){var i=w(t,e,"y2",e.plotgroup.attr("height")/36),s=i[0],u=i[1];e.plotgroup.append("g").attr("class","axis").style("font-size",t.fontSize).attr("transform","translate("+(+e.realwidth+e.margin.left)+","+ +e.margin.top+")").call(s);if(e.y2label){var f=e.realwidth+e.margin.left+e.margin.right-t.fontSize,l=+e.margin.top+e.realheight/2,a=e.plotgroup.append("g").attr("class","axis-label").append("text").attr("x",f+u).attr("y",l).attr("transform","rotate(-90,"+f+","+l+")").style("font-size",t.fontSize).attr("text-anchor","middle").text(e.y2label);y(a,t)}}y(d3.selectAll(".axis text"),t),e.plotgroup.selectAll("g.no-data").remove(),t.nplots==0&&e==t.views[0]&&t.noData&&e.plotgroup.append("g").attr("class","no-data").append("text").attr("x",e.outw/2).attr("y",e.outh/2).attr("text-anchor","middle").text(t.noData);if(e.title&&!e.noTitle){var c=e.plotgroup.append("g").attr("class","axis-label").attr("transform","translate("+(+e.margin.left+e.realwidth/2)+",0)").append("text").attr("x",0).attr("y",Math.floor(1.35*t.titleFontSize)).style("font-size",Math.floor(t.titleFontSize)).attr("text-anchor","middle").text(e.title);t.titleFontFamily&&c.style("font-family",t.titleFontFamily),t.titleFontStyle&&c.style("font-style",t.titleFontStyle),t.titleFontWeight&&c.style("font-weight",t.titleFontWeight),t.titleFontVariant&&c.style("font-variant",t.titleFontVariant)}if(e.x&&e.y||e.x2&&e.y||e.x&&e.y2||e.x2&&e.y2)o(t,function(t){if(t.draw&&t.enabled){var n=!1,r=!1,i=!1,s,o;t.x&&(n="x",s=e.x,i=!!e.x.discrete),t.x2&&(n="x2",s=e.x2,i=!!e.x2.discrete),t.y&&(r="y",o=e.y),t.y2&&(r="y2",o=e.y2),s||(s=e.x),o||(o=e.y);if(n&&r||t.checkPlottable&&t.checkPlottable(n,r)){var u=e.innergroup.append("g"),a=n?t[n][0]instanceof Array&&!e.x.discrete?t[n][t.xidx?t.xidx:0]:t[n]:undefined;t.hasOwnProperty("jitterX")&&a&&(s=E(a,s,t.jitterX));var f=r?t[r][0]instanceof Array?t[r][t.yidx?t.yidx:0]:t[r]:undefined;t.hasOwnProperty("jitterY")&&f&&(o=E(f,o,t.jitterY)),t.draw(u,a,s,f,o,t,e.realwidth,e.realheight,r=="y2"?2:1),t.$on("$destroy",function(){u.remove()})}}}),e.post&&e.post(e.innergroup)}var a=0;return{restrict:"E",template:['<div class="radian">',"<svg></svg>",'<div class="radian-ui">','<div ng-show="uivisible">','<radian-histogram-switch ng-show="histogramSwitchEnabled">',"</radian-histogram-switch>",'<radian-legend ng-show="legendEnabled"></radian-legend>','<radian-axis-switch axis="y" ng-show="yAxisSwitchEnabled">',"</radian-axis-switch>",'<radian-axis-switch axis="x" ng-show="xAxisSwitchEnabled">',"</radian-axis-switch>",'<radian-stroke-switch ng-show="strokeSwitchEnabled">',"</radian-stroke-switch>","</div>","</div>","</div>"].join(""),replace:!0,transclude:!0,scope:!0,compile:function(e,t,n){return{pre:function(e,t,r){f(e,t,r,n)},post:l}}}}]),radian.factory("plotTypeLink",["processAttrs","$timeout",function(e,t){var n=["orientation","fill","fillOpacity","label","marker","markerSize","stroke","strokeOpacity","strokeWidth"];return function(r,i,s,o){function u(){var e=r.xchange||r.ychange;r.xchange=r.ychange=!1,e&&r.$emit("dataChange",r)}e(r,s),i.hide(),r.draw=o,r.$parent.addPlot(r),r.xchange=r.ychange=!1,r.$watch("x",function(e,n){if(e==undefined||e===n||r.xchange)return;r.xchange=!0,t(u)}),r.$watch("y",function(e,n){if(e==undefined||e===n||r.ychange)return;r.ychange=!0,t(u)}),n.forEach(function(e){r.hasOwnProperty(e)&&r.$watch(e,function(){r.$emit("paintChange",r)})})}}]),radian.directive("plotOptions",["processAttrs",function(e){"use strict";return{restrict:"E",template:"<div></div>",replace:!0,transclude:!0,scope:!0,compile:function(t,n,r){return{pre:function(t,n,i){e(t,i),r(t.$new(),function(e){n.append(e)})}}}}}]),radian.factory("estraverse",function(){"use strict";function s(s,o){var u,a,f,l,c,h,p,d,v,m={};u=[s],a=[null];while(u.length){f=u.pop(),l=f.type;if(f===m){f=a.pop(),o.leave?c=o.leave(f,a[a.length-1]):c=undefined;if(c===n.Break)return}else if(f){i.hasOwnProperty(l)&&(f=f.node,l=i[l]),o.enter?c=o.enter(f,a[a.length-1]):c=undefined;if(c===n.Break)return;u.push(m),a.push(f);if(c!==n.Skip){d=r[l],h=d.length;while((h-=1)>=0){v=f[d[h]];if(v)if(t(v)){p=v.length;while((p-=1)>=0)v[p]&&(l===e.ObjectExpression&&"properties"===d[h]&&null==d[h].type?u.push({type:"PropertyWrapper",node:v[p]}):u.push(v[p]))}else u.push(v)}}}}}function o(s,o){function w(e){p=e}var u,a,f,l,c,h,p,d,v,m,g,y={},b;b={top:s},h=[s,b,"top"],u=[h],a=[h];while(u.length){h=u.pop();if(h===y){h=a.pop(),p=undefined,o.leave&&(f=h[0],c=o.leave(h[0],a[a.length-1][0],w),c!==undefined&&(f=c),h[1][h[2]]=f);if(p===n.Break)return b.top}else if(h[0]){p=undefined,f=h[0],l=f.type,i.hasOwnProperty(l)&&(h[0]=f=f.node,l=i[l]),o.enter&&(c=o.enter(h[0],a[a.length-1][0],w),c!==undefined&&(f=c),h[1][h[2]]=f,h[0]=f);if(p===n.Break)return b.top;if(h[0]){u.push(y),a.push(h);if(p!==n.Skip){m=r[l],d=m.length;while((d-=1)>=0){g=f[m[d]];if(g)if(t(g)){v=g.length;while((v-=1)>=0)g[v]&&(l===e.ObjectExpression&&"properties"===m[d]&&null==m[d].type?u.push([{type:"PropertyWrapper",node:g[v]},g,v]):u.push([g[v],g,v]))}else u.push([g,f,m[d]])}}}}}return b.top}var e,t,n,r,i;return e={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},t=Array.isArray,t||(t=function(t){return Object.prototype.toString.call(t)==="[object Array]"}),r={AssignmentExpression:["left","right"],ArrayExpression:["elements"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],Identifier:[],IfStatement:["test","consequent","alternate"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],PluckExpression:["object","property"],PaletteExpression:[],InterpolatorExpression:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"]},n={Break:1,Skip:2},i={PropertyWrapper:"Property"},{Syntax:e,traverse:s,replace:o,VisitorKeys:r,VisitorOption:n}}),radian.factory("radianEval",["$interpolate","plotLib","radianParse","estraverse","genPalFn",function($interpolate,plotLib,radianParse,estraverse,genPalFn){var excnames=["Arguments","Array","Boolean","Date","Error","EvalError","Function","Global","JSON","Math","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError"],radianEval=function(scope,inexpr,returnfvs,skiperrors){if(typeof inexpr!="string"||inexpr.substr(0,2)!="[["&&inexpr.substr(-2)!="]]"){var retexpr=inexpr;return typeof inexpr=="string"&&(retexpr=$interpolate(inexpr)(scope)),returnfvs?[retexpr,[]]:retexpr}var expr=inexpr.substr(2,inexpr.length-4);if(expr=="")return returnfvs?[0,[]]:0;var astorig=radianParse(expr);estraverse.traverse(astorig,{leave:function(e){delete e.start,delete e.end}});var ast=estraverse.replace(astorig,{enter:function(e){return e.type=="PaletteExpression"?{type:"MemberExpression",object:{type:"Identifier",name:"rad$$pal"},property:{type:"Identifier",name:genPalFn(e.palette)}}:e}}),metadatakey=null,dataset=null;estraverse.traverse(ast,{enter:function(e){if(e.type!="PluckExpression"&&e.type!="MemberExpression")return estraverse.VisitorOption.Skip;if(e.property.type=="Identifier"){metadatakey=e.property.name;var t=e.object;while(t.type!="Identifier"&&t.hasOwnProperty("object"))t=t.object;return t.hasOwnProperty("name")&&(dataset=t.name),estraverse.VisitorOption.Break}}});var exc={},excstack=[],fvs={};excnames.forEach(function(e){exc[e]=1}),Object.keys(plotLib).forEach(function(e){exc[e]=1}),estraverse.traverse(ast,{enter:function(e,t){switch(e.type){case"FunctionExpression":excstack.push(e.params.map(function(e){return e.name})),e.params.forEach(function(e){exc[e.name]?++exc[e.name]:exc[e.name]=1});break;case"Identifier":if(e.name!="scope"&&!exc[e.name]){var n=!0;t&&((t.type=="MemberExpression"||t.type=="PluckExpression")&&e==t.property&&!t.computed||!t.hasOwnProperty("type")&&t.hasOwnProperty("key")&&e==t.key)&&(n=!1),n&&(fvs[e.name]=1)}}},leave:function(e){e.type=="FunctionExpression"&&excstack.pop().forEach(function(e){--exc[e]==0&&delete exc[e]})}});var astrepl=estraverse.replace(ast,{leave:function(e){if(e.type=="BinaryExpression"){var t="";switch(e.operator){case"+":t="rad$$add";break;case"-":t="rad$$sub";break;case"*":t="rad$$mul";break;case"/"
:t="rad$$div";break;case"**":t="rad$$pow"}return t?{type:"CallExpression",callee:{type:"Identifier",name:t},arguments:[e.left,e.right]}:e}return e.type=="UnaryExpression"&&e.operator=="-"?{type:"CallExpression",callee:{type:"Identifier",name:"rad$$neg"},arguments:[e.argument]}:e}});astrepl=estraverse.replace(astrepl,{enter:function(e){return e.type=="CallExpression"&&e.callee.type=="PluckExpression"?{type:"CallExpression",callee:{type:"MemberExpression",object:e.callee.object,property:{type:"Identifier",name:"map"},computed:!1},arguments:[{type:"FunctionExpression",id:null,params:[{type:"Identifier",name:"$$x"}],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$$x"},property:e.callee.property,computed:e.callee.computed},arguments:e.arguments}}]}}]}:e},leave:function(e){if(e.type=="PluckExpression")return e.property.type=="Identifier"&&!e.computed?{type:"CallExpression",callee:{type:"Identifier",name:"rad$$pluck"},arguments:[e.object,{type:"Literal",value:e.property.name,raw:"'"+e.property.name+"'"}]}:{type:"CallExpression",callee:{type:"MemberExpression",object:e.object,property:{type:"Identifier",name:"map"},computed:!1},arguments:[{type:"FunctionExpression",id:null,params:[{type:"Identifier",name:"$$x"}],body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"MemberExpression",object:{type:"Identifier",name:"$$x"},property:e.property,computed:e.computed}}]}}]}}}),astrepl=estraverse.replace(astrepl,{enter:function(e,t){switch(e.type){case"FunctionExpression":excstack.push(e.params.map(function(e){return e.name})),e.params.forEach(function(e){exc[e.name]?++exc[e.name]:exc[e.name]=1});break;case"Identifier":if((!t.hasOwnProperty("key")||e!=t.key)&&!exc[e.name]&&fvs[e.name])return{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"scope"},property:{type:"Identifier",name:"$eval"},computed:!1},arguments:[{type:"Literal",value:e.name,raw:"'"+e.name+"'"}]}}return e},leave:function(e){return e.type=="FunctionExpression"&&excstack.pop().forEach(function(e){--exc[e]==0&&delete exc[e]}),e}});var access=escodegen.generate(astrepl),ret=[];try{with(plotLib)eval("ret = "+access)}catch(e){if(!skiperrors)throw Error("radianEval failed on '"+expr+"' -- "+e.message)}return ret&&dataset&&metadatakey&&scope[dataset]&&scope[dataset].metadata&&scope[dataset].metadata[metadatakey]&&(ret.metadata=scope[dataset].metadata[metadatakey]),returnfvs?[ret,Object.keys(fvs)]:ret};return radianEval}]),radian.factory("radianParse",function(){"use strict";function i(n,r){function c(e){return sn(e),i.start=o,i.end=u,i.type=a,i.value=f,i}e=String(n),t=e.length,Ut();var i={};return c.jumpTo=function(t,n){s=t;var r=e.charAt(t-1);l=n,Vt()},c}function g(t,n){var i=r(e,t);n+=" ("+i.line+":"+i.column+")";var o=new SyntaxError(n);throw o.pos=t,o.loc=i,o.raisedAt=s,o}function Lt(e){function o(e){if(e.length==1)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var n=0;n<e.length;++n)t+="case "+JSON.stringify(e[n])+":";t+="return true}return false;"}e=e.split(" ");var t="",n=[],r;for(var i=0;i<e.length;++i){r=!1;for(var s=0;s<n.length;++s)if(n[s][0].length==e[i].length){n[s].push(e[i]),r=!0;break}r||n.push([e[i]]),r=!1}if(n.length>3){n.sort(function(e,t){return t.length-e.length}),t+="switch(str.length){";for(var i=0;i<n.length;++i){var u=n[i];t+="case "+u[0].length+":",o(u)}t+="}"}else o(e);return new Function("str",t)}function qt(e){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e>=170&&Bt.test(String.fromCharCode(e))}function Rt(e){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e>=170&&jt.test(String.fromCharCode(e))}function Ut(){s=0,l=!0,Vt()}function zt(e,t){u=s,a=e,Vt(),f=t,l=e.beforeExpr}function Wt(){var t=e.indexOf("*/",s+=2);t===-1&&g(s-2,"Unterminated comment"),s=t+2}function Xt(){var n=e.charCodeAt(s+=2);while(s<t&&n!==10&&n!==13&&n!==8232&&n!==8329)++s,n=e.charCodeAt(s)}function Vt(){while(s<t){var n=e.charCodeAt(s);if(n===32)++s;else if(n===13){++s;var r=e.charCodeAt(s);r===10&&++s}else if(n===10)++s;else if(n<14&&n>8)++s;else if(n===47){var r=e.charCodeAt(s+1);if(r===42)Wt();else{if(r!==47)break;Xt()}}else if(n<14&&n>8||n===32||n===160)++s;else{if(!(n>=5760&&Dt.test(String.fromCharCode(n))))break;++s}}}function $t(){var t=e.charCodeAt(s+1);return t>=48&&t<=57?ln(!0):(++s,zt(ut))}function Jt(){var t=e.charCodeAt(s+1);return l?(++s,un()):t===61?on(ht,2):on(lt,1)}function Kt(){var t=e.charCodeAt(s+1);if(t===61)return on(ht,2);if(t===42){var n=e.charCodeAt(s+2);return t===61?on(ht,3):on(Nt,2)}return on(Tt,1)}function Qt(t){var n=e.charCodeAt(s+1);return n===t?on(t===124?mt:gt,2):n===61?on(ht,2):on(t===124?yt:wt,1)}function Gt(){var t=e.charCodeAt(s+1);return t===61?on(ht,2):on(bt,1)}function Yt(t){var n=e.charCodeAt(s+1);return n===t?on(dt,2):n===61?on(ht,2):on(pt,1)}function Zt(t){var n=e.charCodeAt(s+1),r=1;return n===t?(r=t===62&&e.charCodeAt(s+2)===62?3:2,e.charCodeAt(s+r)===61?on(ht,r+1):on(xt,r)):(n===61&&(r=e.charCodeAt(s+2)===61?3:2),on(St,r))}function en(t){var n=e.charCodeAt(s+1);return n===61?on(Et,e.charCodeAt(s+2)===61?3:2):on(t===61?ct:vt,1)}function tn(){var t=e.charCodeAt(s+1);if(t==80)return on(X,2);if(t==73)return on(V,2);g("Invalid palette token sequence")}function nn(){function t(e){return e>="0"&&e<="9"||e>="A"&&e<="F"||e>="a"&&e<="f"}++s;var n=0;for(var r=s;t(e.charAt(r))&&n<6;++r)++n;var i;n==6?(i=e.substr(s,6),s+=6):n==3?(i=e.substr(s,3),s+=3):g("Invalid colour constant");var o=S;return zt(o,i)}function rn(t,n){switch(t){case 46:return $t();case 35:return n?nn():(++s,zt(ft));case 40:return++s,zt(nt);case 41:return++s,zt(rt);case 59:return++s,zt(st);case 44:return++s,zt(it);case 91:return++s,zt(Y);case 93:return++s,zt(Z);case 123:return++s,zt(et);case 125:return++s,zt(tt);case 58:return++s,zt(ot);case 63:return++s,zt(at);case 48:var r=e.charCodeAt(s+1);if(r===120||r===88)return fn();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return ln(!1);case 34:case 39:return hn(t);case 47:return Jt(t);case 37:case 42:return Kt();case 124:case 38:return Qt(t);case 94:return Gt();case 43:case 45:return Yt(t);case 60:case 62:return Zt(t);case 61:case 33:return en(t);case 126:return on(vt,1);case 64:return tn(t)}return!1}function sn(n,r){r&&--s,o=s;if(n)return un();if(s>=t)return zt(x);var i=e.charCodeAt(s);if(qt(i)||i===92)return mn();var u=rn(i,r);if(u===!1){var a=String.fromCharCode(i);if(a==="\\"||Bt.test(a))return mn();g(s,"Unexpected character '"+a+"'")}return u}function on(t,n){var r=e.slice(s,s+n);s+=n,zt(t,r)}function un(){var n="",r,i,o=s;for(;;){s>=t&&g(o,"Unterminated regular expression");var u=e.charAt(s);Ft.test(u)&&g(o,"Unterminated regular expression");if(!r){if(u==="[")i=!0;else if(u==="]"&&i)i=!1;else if(u==="/"&&!i)break;r=u==="\\"}else r=!1;++s}var n=e.slice(o,s);++s;var a=vn();return a&&!/^[gmsiy]*$/.test(a)&&g(o,"Invalid regexp flag"),zt(b,new RegExp(n,a))}function an(t,n){var r=s,i=0;for(var o=0,u=n==null?Infinity:n;o<u;++o){var a=e.charCodeAt(s),f;a>=97?f=a-97+10:a>=65?f=a-65+10:a>=48&&a<=57?f=a-48:f=Infinity;if(f>=t)break;++s,i=i*t+f}return s===r||n!=null&&s-r!==n?null:i}function fn(){s+=2;var t=an(16);return t==null&&g(o+2,"Expected hexadecimal number"),qt(e.charCodeAt(s))&&g(s,"Identifier directly after number"),zt(y,t)}function ln(t){var n=s,r=!1,i=e.charCodeAt(s)===48;!t&&an(10)===null&&g(n,"Invalid number"),e.charCodeAt(s)===46&&(++s,an(10),r=!0);var o=e.charCodeAt(s);if(o===69||o===101)o=e.charCodeAt(++s),(o===43||o===45)&&++s,an(10)===null&&g(n,"Invalid number"),r=!0;qt(e.charCodeAt(s))&&g(s,"Identifier directly after number");var u=e.slice(n,s),a;return r?a=parseFloat(u):!i||u.length===1?a=parseInt(u,10):/[89]/.test(u)||m?g(n,"Invalid number"):a=parseInt(u,8),zt(y,a)}function hn(n){s++,cn.length=0;for(;;){s>=t&&g(o,"Unterminated string constant");var r=e.charCodeAt(s);if(r===n)return++s,zt(w,String.fromCharCode.apply(null,cn));if(r===92){r=e.charCodeAt(++s);var i=/^[0-7]+/.exec(e.slice(s,s+3));i&&(i=i[0]);while(i&&parseInt(i,8)>255)i=i.slice(0,i.length-1);i==="0"&&(i=null),++s;if(i)m&&g(s-2,"Octal literal in strict mode"),cn.push(parseInt(i,8)),s+=i.length-1;else switch(r){case 110:cn.push(10);break;case 114:cn.push(13);break;case 120:cn.push(pn(2));break;case 117:cn.push(pn(4));break;case 85:cn.push(pn(8));break;case 116:cn.push(9);break;case 98:cn.push(8);break;case 118:cn.push(11);break;case 102:cn.push(12);break;case 48:cn.push(0);break;case 13:e.charCodeAt(s)===10&&++s;case 10:break;default:cn.push(r)}}else(r===13||r===10||r===8232||r===8329)&&g(o,"Unterminated string constant"),cn.push(r),++s}}function pn(e){var t=an(16,e);return t===null&&g(o,"Bad character escape sequence"),t}function vn(){dn=!1;var t,n=!0,r=s;for(;;){var i=e.charCodeAt(s);if(Rt(i))dn&&(t+=e.charAt(s)),++s;else{if(i!==92)break;dn||(t=e.slice(r,s)),dn=!0,e.charCodeAt(++s)!=117&&g(s,"Expecting Unicode escape sequence \\uXXXX"),++s;var o=pn(4),u=String.fromCharCode(o);u||g(s-1,"Invalid Unicode escape"),(n?!qt(o):!Rt(o))&&g(s-4,"Invalid Unicode escape"),t+=u}n=!1}return dn?t:e.slice(r,s)}function mn(){var e=vn(),t=E;return dn||(_t(e)?t=G[e]:m&&Ot(e)&&g(o,"The keyword '"+e+"' is reserved")),zt(t,e)}function gn(){c=o,h=u,sn()}function yn(e){m=e,s=h,Vt(),sn()}function bn(){this.type=null,this.start=o,this.end=null}function wn(){return new bn}function En(e){var t=new bn;return t.start=e.start,t}function Sn(e,t){return e.type=t,e.end=h,e}function xn(e){return e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&e.expression.value==="use strict"}function Tn(e){if(a===e)return gn(),!0}function Nn(){return a===x||a===tt||Ft.test(e.slice(h,o))}function Cn(){!Tn(st)&&!Nn()&&Ln()}function kn(e){a===e?gn():Ln()}function Ln(){g(o,"Unexpected token")}function An(e){e.type!=="Identifier"&&e.type!=="MemberExpression"&&g(e.start,"Assigning to rvalue"),m&&e.type==="Identifier"&&Mt(e.name)&&g(e.start,"Assigning to "+e.name+" in strict mode")}function On(){return c=h=s,d=m=null,v=[],sn(),In()}function Dn(){a===lt&&sn(!0);var t=a,n=wn();switch(t){case T:case k:gn();var r=t===T;Tn(st)||Nn()?n.label=null:a!==E?Ln():(n.label=tr(),Cn());for(var i=0;i<v.length;++i){var s=v[i];if(n.label==null||s.name===n.label.name){if(!(s.kind==null||!r&&s.kind!=="loop"))break;if(n.label&&r)break}}return i===v.length&&g(n.start,"Unsyntactic "+t.keyword),Sn(n,r?"BreakStatement":"ContinueStatement");case L:return gn(),Cn(),Sn(n,"DebuggerStatement");case O:return gn(),v.push(Mn),n.body=Dn(),v.pop(),kn(R),n.test=Pn(),Cn(),Sn(n,"DoWhileStatement");case D:gn(),v.push(Mn),kn(nt);if(a===st)return Bn(n,null);if(a===q){var u=wn();return gn(),Fn(u,!0),u.declarations.length===1&&Tn(Q)?jn(n,u):Bn(n,u)}var u=In(!1,!0);if(Tn(Q))return An(u),jn(n,u);return Bn(n,u);case P:return gn(),Yn(n,!0);case H:return gn(),n.test=Pn(),n.consequent=Dn(),n.alternate=Tn(M)?Dn():null,Sn(n,"IfStatement");case B:return d||g(o,"'return' outside of function"),gn(),Tn(st)||Nn()?n.argument=null:(n.argument=In(),Cn()),Sn(n,"ReturnStatement");case j:gn(),n.discriminant=Pn(),n.cases=[],kn(et),v.push(_n);for(var l,p;a!=tt;)if(a===N||a===A){var y=a===N;l&&Sn(l,"SwitchCase"),n.cases.push(l=wn()),l.consequent=[],gn(),y?l.test=In():(p&&g(c,"Multiple default clauses"),p=!0,l.test=null),kn(ot)}else l||Ln(),l.consequent.push(Dn());return l&&Sn(l,"SwitchCase"),gn(),v.pop(),Sn(n,"SwitchStatement");case F:return gn(),Ft.test(e.slice(h,o))&&g(h,"Illegal newline after throw"),n.argument=In(),Cn(),Sn(n,"ThrowStatement");case I:gn(),n.block=Hn(),n.handlers=[];while(a===C){var b=wn();gn(),kn(nt),b.param=tr(),m&&Mt(b.param.name)&&g(b.param.start,"Binding "+b.param.name+" in strict mode"),kn(rt),b.guard=null,b.body=Hn(),n.handlers.push(Sn(b,"CatchClause"))}return n.finalizer=Tn(_)?Hn():null,!n.handlers.length&&!n.finalizer&&g(n.start,"Missing catch or finally clause"),Sn(n,"TryStatement");case q:return gn(),n=Fn(n),Cn(),n;case R:return gn(),n.test=Pn(),v.push(Mn),n.body=Dn(),v.pop(),Sn(n,"WhileStatement");case U:return m&&g(o,"'with' in strict mode"),gn(),n.object=Pn(),n.body=Dn(),Sn(n,"WithStatement");case et:return Hn();case st:return gn(),Sn(n,"EmptyStatement");default:var w=f,S=In();if(t===E&&S.type==="Identifier"&&Tn(ot)){for(var i=0;i<v.length;++i)v[i].name===w&&g(S.start,"Label '"+w+"' is already declared");var x=a.isLoop?"loop":a===j?"switch":null;return v.push({name:w,kind:x}),n.body=Dn(),v.pop(),n.label=S,Sn(n,"LabeledStatement")}return n.expression=S,Cn(),Sn(n,"ExpressionStatement")}}function Pn(){kn(nt);var e=In();return kn(rt),e}function Hn(e){var t=wn(),n=!0,r=!1,i;t.body=[],kn(et);while(!Tn(tt)){var s=Dn();t.body.push(s),n&&xn(s)&&(i=r,yn(r=!0)),n=!1}return r&&!i&&yn(!1),Sn(t,"BlockStatement")}function Bn(e,t){return e.init=t,kn(st),e.test=a===st?null:In(),kn(st),e.update=a===rt?null:In(),kn(rt),e.body=Dn(),v.pop(),Sn(e,"ForStatement")}function jn(e,t){return e.left=t,e.right=In(),kn(rt),e.body=Dn(),v.pop(),Sn(e,"ForInStatement")}function Fn(e,t){e.declarations=[],e.kind="var";for(;;){var n=wn();n.id=tr(),m&&Mt(n.id.name)&&g(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=Tn(ct)?In(!0,t):null,e.declarations.push(Sn(n,"VariableDeclarator"));if(!Tn(it))break}return Sn(e,"VariableDeclaration")}function In(e,t){var n=qn(t);if(!e&&a===it){var r=En(n);r.expressions=[n];while(Tn(it))r.expressions.push(qn(t));return Sn(r,"SequenceExpression")}return n}function qn(e){var t=Rn(e);if(a.isAssign){var n=En(t);return n.operator=f,n.left=t,gn(),n.right=qn(e),An(t),Sn(n,"AssignmentExpression")}return t}function Rn(e){var t=Un(e);if(Tn(at)){var n=En(t);return n.test=t,n.consequent=In(!0),kn(ot),n.alternate=In(!0,e),Sn(n,"ConditionalExpression")}return t}function Un(e){return zn(Wn(e),-1,e)}function zn(e,t,n){var r=a.binop;if(r!=null&&(!n||a!==Q)&&r>t){var i=En(e);i.left=e,i.operator=f,gn(),i.right=zn(Wn(n),r,n);var i=Sn(i,/&&|\|\|/.test(i.operator)?"LogicalExpression":"BinaryExpression");return zn(i,t,n)}return e}function Wn(e){if(a.prefix){var t=wn(),n=a.isUpdate;return t.operator=f,t.prefix=!0,gn(),t.argument=Wn(e),n?An(t.argument):m&&t.operator==="delete"&&t.argument.type==="Identifier"&&g(t.start,"Deleting local variable in strict mode"),Sn(t,n?"UpdateExpression":"UnaryExpression")}var r=Xn();while(a.postfix&&!Nn()){var t=En(r);t.operator=f,t.prefix=!1,t.argument=r,An(r),gn(),r=Sn(t,"UpdateExpression")}return r}function Xn(){return Vn(Jn())}function Vn(e,t){if(Tn(ut)){var n=En(e);return n.object=e,n.property=tr(!0),n.computed=!1,Vn(Sn(n,"MemberExpression"),t)}if(Tn(ft)){var n=En(e);return n.object=e,n.computed=$n(n),Vn(Sn(n,"PluckExpression"),t)}if(Tn(Y)){var n=En(e);return n.object=e,n.property=In(),n.computed=!0,kn(Z),Vn(Sn(n,"MemberExpression"),t)}if(!t&&Tn(nt)){var n=En(e);return n.callee=e,n.arguments=er(rt),Vn(Sn(n,"CallExpression"),t)}return e}function $n(t){switch(a){case E:return t.property=tr(),!1;case y:case w:case b:var n=wn();return n.value=f,n.raw=e.slice(o,u),gn(),t.property=Sn(n,"Literal"),!0;case nt:return t.property=Pn(),!0;default:Ln()}}function Jn(){switch(a){case W:var t=wn();return gn(),Sn(t,"ThisExpression");case E:return tr();case y:case w:case b:var t=wn();return t.value=f,t.raw=e.slice(o,u),gn(),Sn(t,"Literal");case $:case J:case K:var t=wn();return t.value=a.atomValue,t.raw=a.keyword,gn(),Sn(t,"Literal");case nt:var n=o;gn();var r=In();return r.start=n,r.end=u,kn(rt),r;case Y:var t=wn();return gn(),t.elements=er(Z,!0),Sn(t,"ArrayExpression");case et:return Qn();case P:var t=wn();return gn(),Yn(t,!1);case X:var t=wn();return gn(),Zn(t);case V:var t=wn();return gn(),parseInterpolator(t);case z:return Kn();default:Ln()}}function Kn(){var e=wn();return gn(),e.callee=Vn(Jn(),!0),Tn(nt)?e.arguments=er(rt):e.arguments=[],Sn(e,"NewExpression")}function Qn(){var e=wn(),t=!0,n=!1;e.properties=[],gn();while(!Tn(tt)){t?t=!1:kn(it);var r={key:Gn()},i=!1,s;Tn(ot)?(r.value=In(!0),s=r.kind="init"):r.key.type!=="Identifier"||r.key.name!=="get"&&r.key.name!=="set"?Ln():(i=n=!0,s=r.kind=r.key.name,r.key=Gn(),a!==nt&&Ln(),r.value=Yn(wn(),!1));if(r.key.type==="Identifier"&&(m||n))for(var o=0;o<e.properties.length;++o){var u=e.properties[o];if(u.key.name===r.key.name){var f=s==u.kind||i&&u.kind==="init"||s==="init"&&(u.kind==="get"||u.kind==="set");f&&!m&&s==="init"&&u.kind==="init"&&(f=!1),f&&g(r.key.start,"Redefinition of property")}}e.properties.push(r)}return Sn(e,"ObjectExpression")}function Gn(){return a===y||a===w?Jn():tr(!0)}function Yn(e,t){a===E?e.id=tr():t?Ln():e.id=null,e.params=[];var n=!0;kn(nt);while(!Tn(rt))n?n=!1:kn(it),e.params.push(tr());var r=d,i=v;d=!0,v=[],e.body=Hn(!0),d=r,v=i;if(m||e.body.body.length&&xn(e.body.body[0]))for(var s=e.id?-1:0;s<e.params.length;++s){var o=s<0?e.id:e.params[s];(Ot(o.name)||Mt(o.name))&&g(o.start,"Defining '"+o.name+"' in strict mode");if(s>=0)for(var u=0;u<s;++u)o.name===e.params[u].name&&g(o.start,"Argument name clash in strict mode")}return Sn(e,t?"FunctionDeclaration":"FunctionExpression")}function Zn(e){var t,n;kn(et),a==E?(n=tr().name.toLowerCase(),"discrete".substr(0,n.length)==n?t="discrete":"absolute".substr(0,n.length)==n?t="absolute":"normalised".substr(0,n.length)==n?t="normalised":Tn(st)?t="colours":Tn(ot)?t="gradient":g("Invalid palette specification")):a==ft?(sn(!1,!0),n="#"+f,gn(),Tn(st)?t="colours":Tn(ot)?t="gradient":g("Invalid palette specification")):t="normalised";var r={type:t};switch(t){case"gradient":var i=n,s;a==E?s=tr().name.toLowerCase():a==ft?(sn(!1,!0),s="#"+f,gn()):g("Invalid palette specification"),kn(tt),r={type:"normalised",values:[0,1],colours:[i,s]};break;case"colours":var o=[n],u=!1;while(!Tn(tt))u?u=!1:kn(st),a==E?o.push(tr().name.toLowerCase()):a==ft?(sn(!1,!0),o.push("#"+f),gn()):g("Invalid palette specification");r={type:"discrete",values:null,colours:o};break;case"absolute":case"normalised":a==E&&(f=="banded"||f=="rgb"||f=="hsl"||f=="hcl"||f=="lab")&&(f=="banded"?(r.banded=!0,gn()):(r.interp=n,gn(),a==E&&f=="banded"&&(r.banded=!0,gn())));case"discrete":var u,l,o;u=!0,l=[],o=[];while(!Tn(tt)){u?u=!1:Tn(st);if(a==E)l.push(tr().name);else if(a==pt){var c=f=="-"?-1:1;gn(),a!=y&&g("Invalid palette specification"),l.push(c*f),gn()}else a==y?(l.push(f),gn()):g("Invalid palette specification");a==E?o.push(tr().name.toLowerCase()):a==ft?(sn(!1,!0),o.push("#"+f),gn()):g("Invalid palette specification")}r.values=l,r.colours=o}var e=wn();return e.palette=r,Sn(e,"PaletteExpression")}function er(e,t){var n=[],r=!0;while(!Tn(e))r?r=!1:kn(it),t&&a===it?n.push(null):n.push(In(!0));return n}function tr(e){var t=wn();return t.name=a===E?f:e&&a.keyword||Ln(),gn(),Sn(t,"Identifier")}var e,t,n=function(n){return e=String(n),t=e.length,Ut(),On()},r=function(e,t){for(var n=1,r=0;;){It.lastIndex=r;var i=It.exec(e);if(!(i&&i.index<t))break;++n,r=i.index+i[0].length}return{line:n,column:t-r}},s,o,u,a,f,l,c,h,p,d,v,m,y={type:"num"},b={type:"regexp"},w={type:"string"},E={type:"name"},S={type:"colour"},x={type:"eof"},T={keyword:"break"},N={keyword:"case",beforeExpr:!0},C={keyword:"catch"},k={keyword:"continue"},L={keyword:"debugger"},A={keyword:"default"},O={keyword:"do",isLoop:!0},M={keyword:"else",beforeExpr:!0},_={keyword:"finally"},D={keyword:"for",isLoop:!0},P={keyword:"function"},H={keyword:"if"},B={keyword:"return",beforeExpr:!0},j={keyword:"switch"},F={keyword:"throw",beforeExpr:!0},I={keyword:"try"},q={keyword:"var"},R={keyword:"while",isLoop:!0},U={keyword:"with"},z={keyword:"new",beforeExpr:!0},W={keyword:"this"},X={keyword:"@P"},V={keyword:"@I"},$={keyword:"null",atomValue:null},J={keyword:"true",atomValue:!0},K={keyword:"false",atomValue:!1},Q={keyword:"in",binop:7,beforeExpr:!0},G={"break":T,"case":N,"catch":C,"continue":k,"debugger":L,"default":A,"do":O,"else":M,"finally":_,"for":D,"function":P,"if":H,"return":B,"switch":j,"throw":F,"try":I,"var":q,"while":R,"with":U,"null":$,"true":J,"false":K,"new":z,"in":Q,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":W,"@P":X,"@I":V,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},Y={type:"[",beforeExpr:!0},Z={type:"]"},et={type:"{",beforeExpr:!0},tt={type:"}"},nt={type:"(",beforeExpr:!0},rt={type:")"},it={type:",",beforeExpr:!0},st={type:";",beforeExpr:!0},ot={type:":",beforeExpr:!0},ut={type:"."},at={type:"?",beforeExpr:!0},ft={type:"#"},lt={binop:10,beforeExpr:!0},ct={isAssign:!0,beforeExpr:!0},ht={isAssign:!0,beforeExpr:!0},pt={binop:9,prefix:!0,beforeExpr:!0},dt={postfix:!0,prefix:!0,isUpdate:!0},vt={prefix:!0,beforeExpr:!0},mt={binop:1,beforeExpr:!0},gt={binop:2,beforeExpr:!0},yt={binop:3,beforeExpr:!0},bt={binop:4,beforeExpr:!0},wt={binop:5,beforeExpr:!0},Et={binop:6,beforeExpr:!0},St={binop:7,beforeExpr:!0},xt={binop:8,beforeExpr:!0},Tt={binop:10,beforeExpr:!0},Nt={binop:11,beforeExpr:!0},Ct={bracketL:Y,bracketR:Z,braceL:et,braceR:tt,parenL:nt,parenR:rt,comma:it,semi:st,colon:ot,dot:ut,question:at,slash:lt,eq:ct,name:E,eof:x,num:y,regexp:b,string:w,hash:ft};for(var kt in G)Ct[kt]=G[kt];var At=Lt("class enum extends super const export import"),Ot=Lt("implements interface let package private protected public static yield"),Mt=Lt("eval arguments"),_t=Lt("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Dt=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,Pt="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Ht="ͱ-ʹ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿",Bt=new RegExp("["+Pt+"]"),jt=new RegExp("["+Pt+Ht+"]"),Ft=/[\n\r\u2028\u2029]/,It=/\r\n|[\n\r\u2028\u2029]/g,cn=[],dn,Mn={kind:"loop"},_n={kind:"switch"};return n}),radian.factory("plotDataHttp",["$http",function(e){function n(e){t.provider=e}var t={provider:e};return t.set=n,t}]),radian.directive("plotData",["$http","processAttrs","plotDataHttp",function(e,t,n){"use strict";function r(e){if(typeof e=="object"){var t;Object.keys(e).forEach(function(n){switch(typeof e[n]){case"object":e[n]&&r(e[n]);break;case"string":t=Number(e[n]),isNaN(t)||(e[n]=t)}})}}function i(e,t,n,i){var s,o=/^\s*[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/;switch(t){case"json":try{s=typeof e=="string"?JSON.parse(e):e,r(s)}catch(u){throw Error("invalid JSON data in <plot-data>")}break;case"csv":try{s=$.csv.toArrays(e.replace(/^\s*\n/g,"").split("\n").map(function(e){return e.replace(/^\s+/,"")}).join("\n"),{separator:i});if(s.length>0){if(n){if(s[0].length!=n.length)throw Error("mismatch between COLS and CSV data in <plot-data>")}else n=s[0],s.splice(0,1);var a={},f=[];for(var l=0;l<n.length;++l)a[n[l]]=[],f.push(s[0][l].match(o));for(var c=0;c<s.length;++c)for(var l=0;l<n.length;++l)f[l]?a[n[l]].push(parseFloat(s[c][l])):a[n[l]].push(s[c][l]);s=a}}catch(u){throw Error("invalid CSV data in <plot-data>")}}return s}function s(e,t,n){function r(e,i){e instanceof Array&&e.length>0?typeof e[0]=="string"&&i?e.forEach(function(t,r){e[r]=n(t)}):e.forEach(function(e){r(e,!1)}):typeof e=="object"&&(!e.hasOwnProperty(t)||e[t]instanceof Array?Object.keys(e).forEach(function(n){r(e[n],n==t)}):e[t]=n(e[t]))}r(e,!1)}function o(e,t,n){if(e[t]&&e[t].metadata)for(var r in e[t].metadata){var i=e[t].metadata[r];if(i.format=="date")if(!i.dateParseFormat)s(n,r,function(e){return new Date(e)});else{var o;i.dateParseFormat=="isodate"?o=d3.time.format.iso.parse:o=d3.time.format(i.dateParseFormat).parse,s(n,r,function(e){return o(e)})}}}function u(e,r,s){function p(){e.firstDataLoad=!0,n.provider.get(e.src).success(function(e,t,n,r){n("Content-Type").indexOf("application/json")==0&&(f="json"),d(e)}).error(function(){throw Error("failed to read data from "+e.src)})}function d(t){var n=i(t,f,c,l);o(e,u,n);var r=e[u]?e[u].metadata:null,s=e.$parent;while(s.$parent&&s.hasOwnProperty("$index"))s=s.$parent;e.subname?(s[u][a]=n,r&&(s[u][a].metadata=r)):(s[u]=n,r&&(s[u].metadata=r))}r.hide(),t(e,s);if(!s.hasOwnProperty("name"))throw Error("<plot-data> must have NAME attribute");var u=e.name,a=s.hasOwnProperty("subname")?e.subname:undefined,f=s.hasOwnProperty("format")?e.format:"json",l=s.hasOwnProperty("separator")?e.separator===""?" ":e.separator||",":",",c=s.hasOwnProperty("cols")?e.cols:undefined;c&&(c=c.split(",").map(function(e){return e.trim()}));if(!s.hasOwnProperty("src")){var h=["json","csv"];if(h.indexOf(f)==-1)throw Error('invalid FORMAT "'+f+'" in <plot-data>')}if(s.hasOwnProperty("src")&&e.src)p();else{var v="";s.hasOwnProperty("ngModel")&&(v=e.$eval(s.ngModel),e.$watch(s.ngModel,function(t,n){if(t==undefined||t==n)return;v=e.$eval(s.ngModel),d(v)},!0)),v==""&&r.contents().each(function(e,t){t instanceof Text&&(v+=t.textContent)}),d(v)}e.$watch("src",function(t,n){if(t==undefined||t==n&&e.firstDataLoad)return;p()})}return{restrict:"E",scope:!0,compile:function(e,t,n){return{post:u}}}}]),radian.directive("metadata",[function(){"use strict";return{restrict:"E",scope:!1,link:function(e,t,n){if(!t[0].parentNode||t[0].parentNode.tagName!="PLOT-DATA"||!$(t[0].parentNode).attr("name"))throw Error("<metadata> not properly nested inside <plot-data>");var r=$(t[0].parentNode).attr("name");if(!n.name)throw Error("<metadata> without NAME attribute");var i=n.name,s={};["dateFormat","dateParseFormat","errorFor","format","label","units","categoryOrder"].forEach(function(e){n.hasOwnProperty(e)&&(s[e]=n[e])}),e[r]||(e[r]={metadata:{}}),e[r].metadata||(e[r].metadata={}),e[r].metadata[i]=s}}}]),radian.factory("layoutSizes",["layoutToString",function(e){"use strict";return function(e,t,n,r){function i(e,t){function s(e){return e.reduce(function(e,t){return e+t},0)}var r=e-n*(t.length-1),i=t.filter(function(e){return e!=null}),o=i.length==0?1:s(i)/i.length,u=t.map(function(e){return e==null?o:e}),a=s(u),f=u.map(function(e){return Math.floor(e*r/a)}),l=r-s(f);if(l!=0){var c=Math.floor(t.length/l);for(var h=0;h<t.length;++h)h%(c+1)==0&&++f[h]}return f}function s(e,t,n){function r(e){return e.map(function(e){return e.size||null})}if(n.type=="plot"||n.type=="empty")return n;var o=i(n.type=="hbox"?e:t,r(n.items)),u=[];for(var a=0;a<n.items.length;++a)n.type=="hbox"?u[a]={size:o[a],item:s(o[a],t,n.items[a].item)}:u[a]={size:o[a],item:s(e,o[a],n.items[a].item)};return{type:n.type,items:u}}var o=s(e,t,r);return r.type=="hbox"?{type:"vbox",items:[{size:t,item:o}]}:r.type=="vbox"?{type:"hbox",items:[{size:e,item:o}]}:{type:"hbox",items:[{size:e,item:{type:"vbox",items:o}}]}}}]),radian.factory("addToLayout",function(){return function(e,t,n,r){t.hasOwnProperty("$id")?e.layoutItems.push({size:n!=null?Number(n):null,item:{type:"plot",items:t}}):e.layoutItems.push({size:n!=null?Number(n):null,item:t})}}),radian.factory("extractFrames",["layoutToString",function(e){return function(e,t,n,r){function i(t,n,r,s,o){var u=[];if(o.type=="hbox")for(var a=0;a<o.items.length;++a){var f=o.items[a].item,l=o.items[a].item.type,c=o.items[a].size;f.type=="plot"?u.push({x:t,y:n,w:c,h:s,plot:f.items}):f.type=="vbox"&&(u=u.concat(i(t,n,c,s,f))),t+=c+e}else{if(o.type!="vbox")throw Error("invalid layout passed to extractFrames");for(var a=0;a<o.items.length;++a){var f=o.items[a].item,l=o.items[a].item.type,c=o.items[a].size;f.type=="plot"?u.push({x:t,y:n,w:r,h:c,plot:f.items}):f.type=="hbox"&&(u=u.concat(i(t,n,r,c,f))),n+=c+e}}return u}return i(0,0,t,n,r)}}]),radian.factory("layoutDirective",["layoutSizes","processAttrs","calcPlotDimensions","addToLayout","extractFrames","layoutToString",function(e,t,n,r,i,s){"use strict";return function(s){function o(e,r,i,s){t(e,i),e.inLayout||(e.layoutTop=!0,e.inLayout=!0,e.inStack||n(e,r,i),$(r).css("width",e.pxwidth).css("height",e.pxheight),e.layoutsvg=r.children()[0]),e.layoutItems=[],s(e.$new(),function(e){r.append(e)})}function u(t,n){t.inLayout&&!t.hasOwnProperty("layoutTop")&&$(n.children()[0]).remove();var o={type:s,items:t.layoutItems};if(t.hasOwnProperty("layoutTop")){var u=t.spacing||0,a=e(t.pxwidth,t.pxheight,u,o),f=i(0,t.pxwidth,t.pxheight,a);t.hasOwnProperty("title")&&(o.title=t.title),f.forEach(function(e){e.plot.pxwidth=e.w,e.plot.pxheight=e.h,$(e.plot.topelem).css("width",e.w).css("height",e.h).css("top",e.y).css("left",e.x),e.plot.svg=d3.select(t.layoutsvg).append("g").attr("width",e.w).attr("height",e.h).attr("transform","translate("+e.x+","+e.y+")")[0][0]})}(!t.hasOwnProperty("layoutTop")||t.inStack)&&r(t.$parent,o,t.layoutShare,n)}return{restrict:"E",template:'<div class="radian" style="top: 0px; left: 0px"><svg></svg></div>',replace:!0,transclude:!0,scope:!0,compile:function(e,t,n){return{pre:function(e,t,r){o(e,t,r,n)},post:u}}}}}]),radian.directive("plotRow",["layoutDirective",function(e){return e("hbox")}]),radian.directive("plotCol",["layoutDirective",function(e){return e("vbox")}]),radian.directive("plotGrid",["layoutSizes","processAttrs","calcPlotDimensions","addToLayout","extractFrames","layoutToString",function(e,t,n,r,i,s){"use strict";function o(e,r,i,s){t(e,i),e.inLayout||(e.layoutTop=!0,e.inLayout=!0,e.inStack||n(e,r,i),$(r).css("width",e.pxwidth).css("height",e.pxheight),e.layoutsvg=r.children()[0]),e.layoutItems=[],s(e.$new(),function(e){r.append(e)})}function u(t,n){t.inLayout&&!t.hasOwnProperty("layoutTop")&&$(n.children()[0]).remove();var s=t.rows||Math.floor(Math.sqrt(t.layoutItems.length)),o=t.cols||Math.ceil(t.layoutItems.length/s),u=[],a=0;for(var f=0;f<s;++f){var l=[];for(var c=0;c<o;++c)a>=t.layoutItems.length?l.push({size:null,item:{type:"empty"}}):l.push(t.layoutItems[a++]);u.push({size:null,item:{type:"hbox",items:l}})}var h={type:"vbox",items:u};if(t.hasOwnProperty("layoutTop")){var p=t.spacing||0,d=e(t.pxwidth,t.pxheight,p,h),v=i(0,t.pxwidth,t.pxheight,d);t.hasOwnProperty("title")&&(h.title=t.title),v.forEach(function(e){e.plot.pxwidth=e.w,e.plot.pxheight=e.h,$(e.plot.topelem).css("width",e.w).css("height",e.h).css("top",e.y).css("left",e.x),e.plot.svg=d3.select(t.layoutsvg).append("g").attr("width",e.w).attr("height",e.h).attr("transform","translate("+e.x+","+e.y+")")[0][0]})}(!t.hasOwnProperty("layoutTop")||t.inStack)&&r(t.$parent,h,t.layoutShare,n)}return{restrict:"E",template:'<div class="radian" style="top: 0px; left: 0px"><svg></svg></div>',replace:!0,transclude:!0,scope:!0,compile:function(e,t,n){return{pre:function(e,t,r){o(e,t,r,n)},post:u}}}}]),radian.directive("plotStack",["$rootScope","layoutSizes","processAttrs","calcPlotDimensions","addToLayout","extractFrames","layoutToString",function(e,t,n,r,i,s,o){"use strict";function u(t,s,o,u){n(t,o);if(t.inLayout)throw Error("<plot-stack> cannot appear inside other layout directives");t.inStack||r(t,s,o),t.inStack&&i(t.$parent,{type:"stack",items:t},null,s),t.inStack=!0,t.layoutItems=[],e.radianNavIDs||(e.radianNavIDs={}),u(t.$new(),function(n){s.append('<div class="tab-content radian-tabs"></div>');var r=s.children(0);r.append(n),t.ids=[],n.filter("div.radian,div.radian-stack").each(function(n){var r=0,i;do++r,i="tab"+r+"_"+n;while(e.radianNavIDs[i]);t.ids.push(i),e.radianNavIDs[i]=1;var s=n==0?"tab-pane active":"tab-pane";$(this).wrap('<div class="'+s+'" id="'+i+'"></div>')})})}function a(e,t){var n=e.layoutItems;t.prepend('<ul class="nav nav-tabs"></ul>');var r=t.children("ul");for(var i=0;i<n.length;++i){var s=n[i].item,o=s.title?s.title:s.items.title?s.items.title:"Tab "+(i+1),u='<a href="#'+e.ids[i]+'" data-toggle="tab">'+o+"</a>",a=i==0?' class="active"':"";r.append("<li"+a+">"+u+"</li>")}}return{restrict:"E",template:'<div class="radian-stack"></div>',replace
:!0,transclude:!0,scope:!0,compile:function(e,t,n){return{pre:function(e,t,r){u(e,t,r,n)},post:a}}}}]),radian.factory("layoutToString",function(){"use strict";return function(e){function t(e){switch(e.type){case"empty":return{type:"empty"};case"plot":return{type:"plot",items:e.items.$id};default:return{type:e.type,items:e.items.map(function(e){return{size:e.size,item:t(e.item)}})}}}return JSON.stringify(t(e))}}),radian.directive("lines",["plotTypeLink",function(e){"use strict";function t(e,t,n,r,i,s){function o(e){return e instanceof Array?function(t,n){return e[n]}:e}var u=s.strokeWidth||1,a=s.strokeOpacity||1,f=s.stroke||"#000",l=s.$eval("strokesel");f instanceof Array&&s.$eval("strokesel")!==undefined&&(f=l?f[l%f.length]:f[0]);if(f instanceof Function){var c=new Array(t.length);for(var h=0;h<t.length;++h)c[h]=h/t.length;f=f(c)}if(u instanceof Array||a instanceof Array||f instanceof Array){var d=200,v=Math.max(1,Math.floor(t.length/d)),m=d3.zip(t,r),g=[],y=[],b=[],w=[],E=0,S=v;while(E<t.length){g.push(m.slice(E,S+1));var x=Math.floor((E+S)/2);y.push(u instanceof Array?u[x]:u),b.push(a instanceof Array?a[x]:a),w.push(f instanceof Array?f[x]:f),E=S,S=E+v}e.selectAll("path").data(g).enter().append("path").attr("class","line").style("stroke-width",function(e,t){return y[t]}).style("stroke-opacity",function(e,t){return b[t]}).style("stroke",function(e,t){return w[t]}).style("fill","none").attr("d",d3.svg.line().x(function(e,t){return n(e[0],t)}).y(function(e,t){return i(e[1],t)}))}else{var p=d3.svg.line().x(function(e,t){return n(e[0],t)}).y(function(e,t){return i(e[1],t)});e.append("path").datum(d3.zip(t,r)).attr("class","line").attr("d",p).style("fill","none").style("stroke-width",u).style("stroke-opacity",a).style("stroke",f)}}return{restrict:"E",scope:!0,link:function(n,r,i){n.$on("setupExtra",function(){var e=n.strokeWidth instanceof Array&&n.strokeWidth.length>0?n.strokeWidth.reduce(function(e,t){return Math.max(Number(e),Number(t))}):Number(n.strokeWidth)||1;n.rangeExtendPixels([e/2,e/2],[e/2,e/2])}),e(n,r,i,t)}}}]),radian.directive("points",["plotTypeLink",function(e){"use strict";function t(e,t,n,r,i,s){function d(e){return e instanceof Array?function(t,n){return e[n]}:e}function v(e,t,n){var r=t;return e.oton&&(r=e.oton(t)),e(r,n)}var o=s.marker||"circle",u=s.markerSize||1,a=s.stroke||"#000",f=s.strokeWidth||1,l=s.strokeOpacity||1,c=s.fill||"none",h=s.fillOpacity||1,p=s.orientation||0,m=d3.svg.symbol().type(d(o)).size(d(u));e.selectAll("path").data(d3.zip(t,r)).enter().append("path").attr("transform",function(e,t){return"translate("+v(n,e[0],t)+","+v(i,e[1],t)+")"}).attr("d",m).style("fill",d(c)).style("fill-opacity",d(h)).style("stroke-width",d(f)).style("stroke-opacity",d(l)).style("stroke",d(a))}return{restrict:"E",scope:!0,link:function(n,r,i){n.$on("setupExtra",function(){var e=n.strokeWidth instanceof Array&&n.strokeWidth.length>0?n.strokeWidth.reduce(function(e,t){return Math.max(Number(e),Number(t))}):Number(n.strokeWidth)||1;n.stroke=="none"&&(e=0);var t=n.markerSize instanceof Array&&n.markerSize.length>0?n.markerSize.reduce(function(e,t){return Math.max(Number(e),Number(t))}):Number(n.markerSize)||1,r=(e+Math.sqrt(t))/2;n.rangeExtendPixels([r,r],[r,r])}),e(n,r,i,t)}}}]),radian.directive("bars",["plotTypeLink","plotLib",function(e,t){"use strict";function n(e,n,r,i,s,o,u,a){function L(e,t,n){var r=t;return e.oton&&(r=e.oton(t)),e(r,n)}function A(e){return e instanceof Array?function(t,n){return e[n]}:e}function O(e){return S?x?r.invert(r(o.barWidths[0])-E):w:o.barWidths[e]*w}var f=n,l=i,c=o.style||"simple",h=o.aggregation||"none",p=o.strokeWidth||1,d=o.strokeOpacity||1,v=o.stroke||"#000",m=o.fillOpacity||1,g=o.fill||"none",y=o.barMin||null,b=o.barMax||null,w=o.barWidth||1,E,S=!1,x=!1;typeof w=="string"&&w.trim().substr(-2,2)=="px"&&(E=Number(w.trim().substr(0,w.trim().length-2)),E<0&&(x=!0),w=r.invert(Math.abs(E))-r.invert(0),E=Math.abs(E),S=!0);var T=o.barOffset||0,N=!1;if(typeof T=="string"&&T.trim().substr(-2,2)=="px"){var C=Number(barOFfset.trim().substr(0,T.trim().length-2));T=r.invert(C)-r.invert(0),N=!0}if(h!="none"||c!="simple"){var k;switch(h){case"mean":k=t.meanBy;break;case"sum":k=t.sumBy;break;case"max":k=t.maxBy;break;case"min":k=t.minBy;break;default:throw Error("Unknown aggregation type: "+h)}f=t.unique(n),l=k(i,n),o.barWidths=t.firstBy(o.barWidths,n),g instanceof Array&&(g=t.firstBy(g,n)),m instanceof Array&&(m=t.firstBy(m,n)),p instanceof Array&&(p=t.firstBy(p,n)),d instanceof Array&&(d=t.firstBy(d,n)),v instanceof Array&&(v=t.firstBy(v,n))}var M;y&&b?M=d3.zip(y,b,l):M=d3.zip(f,l),e.selectAll("rect").data(M).enter().append("rect").attr("class","bar").attr("x",function(e,t){if(e.length==3)return L(r,e[0],t);if(S&&x&&o.axisXTransform=="log"){var n=o.x[t],i=t>0?o.x[t-1]:n/(o.x[t+1]/n),s=t<o.x.length-1?o.x[t+1]:n*(n/o.x[t-1]),u=n*Math.sqrt(s/n),a=n*Math.sqrt(i/n),f=r(u),l=r(a);return l+E}return e[0]instanceof Date?r(new Date(e[0].valueOf()-O(t)/2+(N?T:o.barWidths[t]*T)),t):r(r.oton(e[0])-O(t)/2+(N?T:o.barWidths[t]*T),t)}).attr("y",function(e,t){return s(e[e.length-1],t)}).attr("width",function(e,t){var n;if(S)if(x)if(o.axisXTransform=="log"){var i=o.x[t],s=t>0?o.x[t-1]:i/(o.x[t+1]/i),u=t<o.x.length-1?o.x[t+1]:i*(i/o.x[t-1]),a=i*Math.sqrt(u/i),f=i*Math.sqrt(s/i),l=r(a),c=r(f);n=l-c-E}else n=r(o.barWidths[t])-r(0)-E;else n=E;else e.length==3?n=L(r,e[1],t)-L(r,e[0],t):n=e[0]instanceof Date?r(new Date(e[0].valueOf()+o.barWidths[t]*w/2),t)-r(new Date(e[0].valueOf()-o.barWidths[t]*w/2),t):r(r.oton(e[0])+o.barWidths[t]*w/2,t)-r(r.oton(e[0])-o.barWidths[t]*w/2,t);return n}).attr("height",function(e,t){return a-s(e[e.length-1])}).style("fill",A(g)).style("fill-opacity",A(m)).style("stroke-width",A(p)).style("stroke-opacity",A(d)).style("stroke",A(v))}return{restrict:"E",scope:!0,link:function(t,r,i){t.$on("setupExtra",function(){var e=t.x||[];t.x&&t.x instanceof Array&&(typeof t.x[0]=="string"||t.x[0]instanceof Array||t.discreteX)&&(e=[],t.x.forEach(function(t,n){e.push(n+1)}));if(t.barMin&&t.barMax){t.barWidths=t.barMax.map(function(e,n){return e-t.barMin[n]});var n=e.length-1;t.rangeXExtend=[e[0]-t.barMin[0],t.barMax[n]-e[n]]}else t.barWidths=e.map(function(t,n){return n==0?e[1]-t:n==e.length-1?t-e[e.length-2]:(e[n+1]-e[n-1])/2}),t.rangeXExtend=[t.barWidths[0]/2,t.barWidths[e.length-1]/2];var r=t.strokeWidth instanceof Array&&t.strokeWidth.length>0?t.strokeWidth.reduce(function(e,t){return Math.max(Number(e),Number(t))}):Number(t.strokeWidth)||1;t.rangeExtendPixels([2*r,2*r],null)}),t.$on("setupRanges",function(e,t){t.yrange?t.yrange[0]=0:t.yrange=[0,null],t.y2range?t.y2range[0]=0:t.y2range=[0,null]}),e(t,r,i,n)}}}]),radian.directive("boxes",["plotTypeLink","plotLib",function(e,t){"use strict";function n(e,n,r,i,s,o,u,a){function x(e){return e instanceof Array?function(t,n){return e[n]}:e}var f=n,l=i,c=o.strokeWidth||1,h=o.strokeOpacity||1,p=o.stroke||"#000",d=o.fillOpacity||1,v=o.fill||"none",m=o.barWidth||.5,g,y=!1;typeof m=="string"&&m.trim().substr(-2,2)=="px"&&(g=Number(m.trim().substr(0,m.trim().length-2)),m=r.invert(g)-r.invert(0),y=!0),f=t.unique(n);var b=t.quantileBy(i,n,.25),w=t.quantileBy(i,n,.5),E=t.quantileBy(i,n,.75),S=d3.zip(b,w,E);o.barWidths=t.firstBy(o.barWidths,n),v instanceof Array&&(v=t.firstBy(v,n)),d instanceof Array&&(d=t.firstBy(d,n)),c instanceof Array&&(c=t.firstBy(c,n)),h instanceof Array&&(h=t.firstBy(h,n)),p instanceof Array&&(p=t.firstBy(p,n));var T=d3.zip(f,S);e.selectAll("rect").data(T).enter().append("rect").attr("class","bar").attr("x",function(e,t){return r(r.oton(e[0])-(y?m:o.barWidths[t]*m)/2,t)}).attr("y",function(e,t){return s(e[1][2],t)}).attr("width",function(e,t){return y?g:r(r.oton(e[0])+o.barWidths[t]*m/2,t)-r(r.oton(e[0])-o.barWidths[t]*m/2,t)}).attr("height",function(e,t){return s(e[1][0],t)-s(e[1][2],t)}).style("fill",x(v)).style("fill-opacity",x(d)).style("stroke-width",x(c)).style("stroke-opacity",x(h)).style("stroke",x(p)),e.selectAll("line.median").data(T).enter().append("line").attr("class","median").style("stroke-width",x(c)).style("stroke-opacity",x(h)).style("stroke",x(p)).style("fill","none").attr("x1",function(e,t){return r(r.oton(e[0])-(y?m:o.barWidths[t]*m)/2,t)}).attr("x2",function(e,t){return r(r.oton(e[0])+(y?m:o.barWidths[t]*m)/2,t)}).attr("y1",function(e,t){return s(e[1][1],t)}).attr("y2",function(e,t){return s(e[1][1],t)}),e.selectAll("line.iqr-up").data(T).enter().append("line").attr("class","iqr-up").style("stroke-width",x(c)).style("stroke-opacity",x(h)).style("stroke",x(p)).style("fill","none").attr("x1",function(e,t){return r(r.oton(e[0]),t)}).attr("x2",function(e,t){return r(r.oton(e[0]),t)}).attr("y1",function(e,t){return s(e[1][2],t)}).attr("y2",function(e,t){return s(e[1][2]+1.5*(e[1][2]-e[1][0]),t)}),e.selectAll("line.iqr-up-bar").data(T).enter().append("line").attr("class","iqr-up-bar").style("stroke-width",x(c)).style("stroke-opacity",x(h)).style("stroke",x(p)).style("fill","none").attr("x1",function(e,t){return r(r.oton(e[0])-(y?m:o.barWidths[t]*m)/3,t)}).attr("x2",function(e,t){return r(r.oton(e[0])+(y?m:o.barWidths[t]*m)/3,t)}).attr("y1",function(e,t){return s(e[1][2]+1.5*(e[1][2]-e[1][0]),t)}).attr("y2",function(e,t){return s(e[1][2]+1.5*(e[1][2]-e[1][0]),t)}),e.selectAll("line.iqr-down").data(T).enter().append("line").attr("class","iqr-down").style("stroke-width",x(c)).style("stroke-opacity",x(h)).style("stroke",x(p)).style("fill","none").attr("x1",function(e,t){return r(r.oton(e[0]),t)}).attr("x2",function(e,t){return r(r.oton(e[0]),t)}).attr("y1",function(e,t){return s(e[1][0],t)}).attr("y2",function(e,t){return s(e[1][0]-1.5*(e[1][2]-e[1][0]),t)}),e.selectAll("line.iqr-down-bar").data(T).enter().append("line").attr("class","iqr-down-bar").style("stroke-width",x(c)).style("stroke-opacity",x(h)).style("stroke",x(p)).style("fill","none").attr("x1",function(e,t){return r(r.oton(e[0])-(y?m:o.barWidths[t]*m)/3,t)}).attr("x2",function(e,t){return r(r.oton(e[0])+(y?m:o.barWidths[t]*m)/3,t)}).attr("y1",function(e,t){return s(e[1][0]-1.5*(e[1][2]-e[1][0]),t)}).attr("y2",function(e,t){return s(e[1][0]-1.5*(e[1][2]-e[1][0]),t)})}return{restrict:"E",scope:!0,link:function(t,r,i){t.$on("setupExtra",function(){var e=t.x||[];t.x&&t.x instanceof Array&&(typeof t.x[0]=="string"||t.x[0]instanceof Array||t.discreteX)&&(e=[],t.x.forEach(function(t,n){e.push(n+1)})),t.barWidths=e.map(function(t,n){return n==0?e[1]-t:n==e.length-1?t-e[e.length-2]:(e[n+1]-e[n-1])/2}),t.rangeXExtend=[t.barWidths[0]/2,t.barWidths[e.length-1]/2];var n=t.strokeWidth instanceof Array&&t.strokeWidth.length>0?t.strokeWidth.reduce(function(e,t){return Math.max(Number(e),Number(t))}):Number(t.strokeWidth)||1;t.rangeExtendPixels([2*n,2*n],[20,20])}),e(t,r,i,n)}}}]),radian.directive("area",["plotTypeLink",function(e){"use strict";function t(e,t,n,r,i,s,o){var u=s.fillOpacity||1,a=s.fill||"#000",f=o==1?"ymin":"y2min",l,c=0;s.hasOwnProperty(f)&&(c=s[f]);if(c instanceof Array)l=c;else{l=new Array(t.length);for(var h=0;h<l.length;++h)l[h]=Number(c)}if(u instanceof Array||a instanceof Array)throw Error("<area> plots require singular paint attributes");var p=d3.svg.area().x(function(e){return n(e[0],h)}).y0(function(e){return i(e[1],h)}).y1(function(e){return i(e[2],h)});e.append("path").datum(d3.zip(t,l,r)).attr("class","area").attr("d",p).style("fill-opacity",u).style("fill",a)}return{restrict:"E",scope:!0,link:function(n,r,i){e(n,r,i,t)}}}]),radian.directive("rug",["plotTypeLink",function(e){"use strict";function t(e,t,n,r,i,s){function l(e){return e instanceof Array?function(t,n){return e[n]}:e}var o=s.stroke||"#000",u=s.strokeWidth||1,a=s.strokeOpacity||1,f=Number(s.tickLength||5),c=[],h=[],p=n.range(),d=i.range();if(t){var v=i.invert(d[0]),m=i.invert(d[0]-f);c=t.map(function(e){return[[e,v],[e,m]]})}if(r){var g=n.invert(p[0]),y=n.invert(p[0]+f);h=r.map(function(e){return[[g,e],[y,e]]})}var b=c.concat(h);e.selectAll("path").data(b).enter().append("path").attr("class","line").style("stroke-width",l(u)).style("stroke-opacity",l(a)).style("stroke",l(o)).attr("d",d3.svg.line().x(function(e,t){return n(e[0],t)}).y(function(e,t){return i(e[1],t)}))}return{restrict:"E",scope:!0,link:function(n,r,i){n.checkPlottable=function(e,t){return e||t},e(n,r,i,t)}}}]),radian.directive("palette",["processAttrs","radianEval","discPalFn","contPalFn",function(e,t,n,r){"use strict";return{restrict:"E",scope:!1,link:function(i,s,o){s.hide(),e(i,o);if(!i.name)throw Error("<palette> directive without NAME attribute");var u=i.name,a=i.type||"norm",f=i.interp||"hsl";f=f.toLowerCase();var l=i.hasOwnProperty("banded"),c="";s.contents().each(function(e,t){t instanceof Text&&(c+=t.textContent)}),c=t(i,c.trim()),c=c.replace(/\n/g,";");var h;switch(a){case"discrete":h=n(c);break;case"abs":h=r(!0,c,l,f);break;case"norm":h=r(!1,c,l,f);break;default:throw Error("invalid <palette> type: "+a)}var p=i;while(p.$parent&&p.hasOwnProperty("$index"))p=p.$parent;p[u]=h}}}]),radian.factory("discPalFn",function(){var e='[^"\\s]+',t='"[^"]*"',n=e+"|"+t,r="(?:("+n+")\\s+)?([^\\s;]+)",i="(?:(?:"+n+")\\s+)?(?:[^\\s;]+)",s="("+i+")((?:\\s*;\\s*"+i+")*)",o=new RegExp(r),u=new RegExp(s),a=/\s*;\s*(.*)/;return function(e){function t(e,t,n){if(n instanceof Array){var r={};n.forEach(function(e){r[e]=1});var i=Object.keys(r).sort();return n.map(function(n){return t[i.indexOf(n)%e]})}if(typeof n=="number")return t[(Math.round(n)-1)%e];throw Error("invalid operand to discrete palette function")}function n(e,t){return t instanceof Array?t.map(function(t){return e[t]}):e[t]}e=e.trim();var r=[],i=[],s=0,f;for(;;){f=e.match(u);if(!f)throw Error("invalid palette definition");var l=f[1],c=l.match(o);if(!c)throw Error("invalid palette definition");c[1]&&(r.push(c[1].charAt(0)=='"'?c[1].slice(1,-1):c[1]),++s),i.push(c[2]);if(f[2]=="")break;var h=f[2].match(a);if(!h)throw Error("invalid palette definition");e=h[1]}if(s==0){var p=i.length,d="["+i.map(function(e){return'"'+e+'"'}).join(",")+"]";return function(e){return t(p,d,e)}}if(s==i.length){var d={};for(var v=0;v<i.length;++v)d[r[v]]=i[v];return function(e){return n(d,e)}}throw Error("invalid palette definition")}}),radian.factory("contPalFn",function(){return function(e,t,n,r){function i(e,t){if(t instanceof Array){var n=d3.extent(t),r=d3.scale.linear().domain(n);return t.map(function(t){return e(r(t))})}throw Error("normalised palettes must be applied to array arguments")}function s(e,t){return t instanceof Array?t.map(function(t){return e(t)}):e(t)}var o;if(n)o=function(e,t){return function(t){return e}};else switch(r){case"rgb":o=d3.interpolateRgb;break;case"hcl":o=d3.interpolateHcl;break;case"lab":o=d3.interpolateLab;break;default:o=d3.interpolateHsl}var u=t.split(";").map(function(e){return e.trim()}).filter(function(e){return e.length>0});if(!u.every(function(e){return e.indexOf(" ")!=-1}))throw Error("invalid format in <palette>");var a=[],f=[];u.forEach(function(e){var t=e.split(" ");a.push(Number(t[0].trim())),f.push(t[1].trim())});for(var l=1;l<a.length;++l)if(a[l]<a[l-1])throw Error("entries out of order in <palette>");var c=a[0],h=a[a.length-1];n&&(e?(a.push(Number.MAX_VALUE),f.push("black"),h=Number.MAX_VALUE):h!=1&&(a.push(1),f.push("black"),h=1));if(!!e||c==0&&h==1){var p=d3.scale.linear().clamp(!0).interpolate(o).domain(a).range(f);return e?function(e){return s(p,e)}:function(e){return i(p,e)}}throw Error("invalid segment limits for normalised palette")}}),radian.factory("genPalFn",["discPalFn","contPalFn","MD5","plotLib",function(e,t,n,r){"use strict";return function(i){var s;i.values?s=d3.zip(i.values,i.colours).map(function(e){return e.join(" ")}).join(";"):s=i.colours.join(";");var o=i.type.charAt(0)+n(JSON.stringify(s));if(!r.rad$$pal[o]){var u,a=i.interp||"hsl",f=i.banded;switch(i.type){case"discrete":u=e(s);break;case"absolute":u=t(!0,s,f,a);break;case"normalised":u=t(!1,s,f,a)}r.rad$$pal[o]=u}return o}}]),radian.factory("plotLib",function(){"use strict";function e(e){return function(t){return t instanceof Array?t.map(e):e(t)}}function t(e){return function(t,n){var r=t instanceof Array,i=n instanceof Array;if(!r&&!i)return e(t,n);var s=r?t.length:0,o=i?n.length:0,u=r&&i?Math.min(s,o):Math.max(s,o),a=new Array(u),f;r&&i?f=function(r){return e(t[r],n[r])}:r?f=function(r){return e(t[r],n)}:f=function(r){return e(t,n[r])};for(var l=0;l<u;++l)a[l]=f(l);return a}}function n(e){return function(t,n){var r={},i=[];t.forEach(function(e,t){r[n[t]]?r[n[t]].push(e):(i.push(n[t]),r[n[t]]=[e])});var s=[];return i.forEach(function(t){s.push(e(r[t]))}),s}}function r(e,t,n){return d3.range(e,t,(t-e)/(n-1))}function i(e,t,n){return d3.range(e,t,n)}function s(e){var t=d3.mean(e),n=d3.mean(e,function(e){return e*e});return Math.sqrt(n-t*t)}function o(e){var t=[],n={};return e.forEach(function(e){n[e]||(t.push(e),n[e]=1)}),t}function u(e){function t(e){var t=0;return e.forEach(function(e){t+=e}),t}var n=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-0.000005395239384953],r=1.000000000190015,i=e+5.5-(e+.5)*Math.log(e+5.5),s=r+t(n.map(function(t,n){return t/(e+n+1)}));return-i+Math.log(2.5066282746310007*s/e)}function a(t,n,r){var i=1/(r*Math.sqrt(2*Math.PI)),s=2*r*r;return e(function(e){return i*Math.exp(-(e-n)*(e-n)/s)})(t)}function f(t,n,r){var i=1/(r*Math.sqrt(2*Math.PI)),s=2*r*r;return e(function(e){return e<=0?0:i/e*Math.exp(-(Math.log(e)-n)*(Math.log(e)-n)/s)})(t)}function l(t,n,r){var i=n*Math.log(r)+u(n);return e(function(e){return e<=0?0:Math.exp((n-1)*Math.log(e)-e/r-i)})(t)}function c(t,n,r){var i=n*Math.log(r)-u(n);return e(function(e){return e<=0?0:Math.exp(cval-r/e-(n+1)*Math.log(e))})(t)}function h(e,t){function n(e){return e}if(typeof t=="number"||typeof t=="string")t={nbins:Number(t)};var r=e,i=null,s=null;if(t.hasOwnProperty("transform")){i=t.transform;if(typeof i=="string")switch(i){case"linear":i=[n,n],s="linear";break;case"log":i=[Math.log,Math.exp],s="log";break;default:throw Error("unknown coordinate transform in histogram")}if(!(i instanceof Array&&i.length==2))throw Error("invalid coordinate transform in histogram");r=e.map(i[0])}var o=d3.extent(r);t.hasOwnProperty("binrange")&&(o=angular.copy(t.binrange),s=="log"&&(o[0]=Math.log(o[0]),o[1]=Math.log(o[1])));var u=null,a=null;t.hasOwnProperty("nbins")?(a=t.nbins,u=(o[1]-o[0])/a):t.hasOwnProperty("binwidth")&&(u=t.binwidth,a=Math.floor((o[1]-o[0])/u));var f=[],l=[];for(var c=0;c<a;++c)f.push(0);for(var c=0;c<r.length;++c)++f[Math.min(a-1,Math.max(0,Math.floor((r[c]-o[0])/u)))];for(var c=0;c<a;++c)l.push(f[c]/r.length);var h=[],p=[],d=.5*u;for(var c=0;c<a;++c){var v=o[0]+u*(c+.5),m=v-d,g=v+d;i&&(v=i[1](v),m=i[1](m),g=i[1](g)),h.push(v),p.push([m,g])}var y=0,b=[];for(var c=0;c<a;++c)y+=l[c]*(p[c][1]-p[c][0]);for(var c=0;c<a;++c)b.push(l[c]/y);var w={centres:h,bins:p,counts:f,freqs:l,probs:b};return w}function p(e){var t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(var r=0;r<e.length;++r)if(e[r]instanceof Array){var i=p(e[r]);t=Math.min(t,i[0]),n=Math.max(n,i[1])}else t=Math.min(t,e[r]),n=Math.max(n,e[r]);return[t,n]}function d(e,t,n){var r=n||"linear",i;switch(r){case"linear":i=d3.scale.linear();break;case"sqrt":i=d3.scale.sqrt();break;case"log":i=d3.scale.log();break;default:if(r.substr(0,4)!="pow:")throw Error("invalid interpolation type");i=d3.scale.pow().exponent(Number(r.substr(5)))}var s=e||[0,1];s=p(s);var o=t||[0,1];o=p(o);var u=i.domain(s).range(o);return function(e){return e.map(u)}}function v(){if(arguments.length==0)return[];var e=d3.extent(arguments[0]);for(var t=1;t<arguments.length;++t){var n=d3.extent(arguments[t]);e=d3.extent([e[0],e[1],n[0],n[1]])}return e}function m(e){function n(e){e instanceof Array?e.forEach(n):t.push(e)}if(e==undefined||!e)return e;var t=[];return n(e),t}function g(){function o(t){var n=[];e[t].metadata&&e[t].metadata.categoryOrder&&(n=e[t].metadata.categoryOrder.split(/;/));if(t>=e.length-1)return n;var r=o(t+1),i=[];return n.length==0?r.forEach(function(e){i.push(","+e)}):n.forEach(function(e){r.forEach(function(t){i.push(e+","+t)})}),i}var e=arguments,t=e.length;if(!t)return[];var n=d3.min(e,function(e){return e.length}),r=new Array(n);for(var i=0;i<n;++i){r[i]=new Array(t);for(var s=0;s<t;++s)r[i][s]=e[s][i]}var u=!1;for(var i=0;i<t;++i)if(e[i].metadata&&e[i].metadata.categoryOrder){u=!0;break}return u&&(r.metadata={categoryOrder:o(0).join(";")}),r}function y(e,t){var n=e.map(function(e){return e[t]});return e.metadata&&e.metadata[t]&&(n.metadata=e.metadata[t]),n}function b(e,t,n){var r={},i=[];e.forEach(function(e,n){r[t[n]]?r[t[n]].push(e):(i.push(t[n]),r[t[n]]=[e])});var s=[];return i.forEach(function(e){r[e].sort(),s.push(d3.quantile(r[e],n))}),s}return{E:Math.E,LN10:Math.LN10,LN2:Math.LN2,LOG10E:Math.LOG10E,LOG2E:Math.LOG2E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,abs:e(Math.abs),acos:e(Math.acos),asin:e(Math.asin),atan:e(Math.atan),ceil:e(Math.ceil),cos:e(Math.cos),exp:e(Math.exp),floor:e(Math.floor),log:e(Math.log),round:e(Math.round),sin:e(Math.sin),sqrt:e(Math.sqrt),tan:e(Math.tan),atan2:Math.atan2,pow:Math.pow,min:d3.min,max:d3.max,extent:v,flatten:m,sum:d3.sum,mean:d3.mean,median:d3.median,quantile:d3.quantile,category10:e(d3.scale.category10()),category20:e(d3.scale.category20()),zip:g,seq:r,seqStep:i,sdev:s,unique:o,minBy:n(d3.min),maxBy:n(d3.max),sumBy:n(d3.sum),meanBy:n(d3.mean),medianBy:n(d3.median),sdevBy:n(s),firstBy:n(function(e){return e[0]}),quantileBy:b,normal:a,lognormal:f,gamma:l,invgamma:c,histogram:h,interpolate:d,rad$$neg:e(function(e){return-e}),rad$$add:t(function(e,t){return e+t}),rad$$sub:t(function(e,t){return e-t}),rad$$mul:t(function(e,t){return e*t}),rad$$div:t(function(e,t){return e/t}),rad$$pow:t(function(e,t){return Math.pow(e,t)}),rad$$pluck:y,rad$$pal:{}}}),radian.directive("radianLegend",function(){return{restrict:"E",template:['<div class="radian-legend">','<span ng-style="colour(v)" ng-repeat="v in switchable">',"{{v.label}}&nbsp;",'<input type="checkbox" ng-model="v.enabled" ',"ng-change=\"$emit('paintChange')\">","&nbsp;&nbsp;&nbsp;","</span>","</div>"].join(""),replace:!0,scope:!0,link:function(e,t,n){e.colour=function(e){var t=(e.stroke instanceof Array?e.stroke[0]:e.stroke)||"#000";return{color:t}},e.$on("setupExtraAfter",function(){var n=e.views[0].margin;t.css("top",n.top+3+"px").css("right",n.right+3+"px")})}}}),radian.directive("radianAxisSwitch",function(){return{restrict:"E",template:['<div class="radian-axis-switch">','<button class="btn btn-mini" ng-click="switchState()">',"{{axisName}} axis &rArr; {{label}}","</button>","</div>"].join(""),replace:!0,scope:!0,link:function(e,t,n){function a(){switch(e.states[(e.idx+1)%e.states.length]){case"linear":e.label="Linear";break;case"log":e.label="Log";break;case"linear-0":e.label="Linear (from 0)"}}var r=n.axis||"y";e.axisName=r=="y"?"Y":"X";var i=r=="y"?"uiAxisYTransform":"uiAxisXTransform",s=r=="y"?"axisYTransform":"axisXTransform",o=e[i]||"log";e.states=o.split(/,/),e.states.length==1&&e.states[0]!="linear"&&e.states.unshift("linear");for(var u=0;u<e.states.length;++u)if(["linear","log","linear-0"].indexOf(e.states[u])<0)throw Error("invalid UI axis switch type");e.state=e[s]||e.states[0],e.idx=Math.max(0,e.states.indexOf(e.state)),a(),e.$on("setupExtraAfter",function(){var n=e.views[0].margin;r=="y"?t.css("top",n.top+3+"px").css("left",n.left+3+"px"):t.css("bottom",n.bottom+3+"px").css("right",n.right+3+"px")}),e.switchState=function(){e.idx=(e.idx+1)%e.states.length,e.state=e.states[e.idx],a(),e.$emit(r=="y"?"yAxisChange":"xAxisChange",e.state)}}}}),radian.directive("radianStrokeSwitch",function(){return{restrict:"E",template:['<div class="radian-stroke-switch">','<div ng-show="swbut">',"<span>{{swbutlab}}</span>",'<button class="btn btn-mini" data-toggle="button" ','ng-click="$parent.strokesel=1-$parent.strokesel">',"{{swbut}}","</button>","</div>",'<div class="btn-group" ng-show="swsel">','<button class="btn btn-mini" ng-click="stepStroke()">',"{{swsel[$parent.strokesel]}} &nbsp;&nbsp;&nbsp;&nbsp;&rArr;","</button>","</div>","</div>"].join(""),replace:!0,scope:!0,link:function(e,t,n){if(!e.strokeSwitch)return;e.$on("setupExtraAfter",function(){var n=e.views[0].margin,r=e.legendEnabled?25:0;t.css("top",n.top+r+3+"px").css("right",n.right+3+"px")}),e.switches=e.strokeSwitch.split(";"),e.stepStroke=function(){e.$parent.strokesel=(e.$parent.strokesel+1)%e.switches.length};var r=e.strokeSwitchLabel;e.switches.length==1?(e.swbut=e.switches[0],e.swbutlab=r):e.swsel=e.switches}}}),radian.directive("radianHistogramSwitch",function(){return{restrict:"E",template:['<div class="radian-histogram-switch btn-group">','<button class="btn btn-mini">',"Bins: {{uiNBins}}","</button>",'<button class="btn btn-mini" ng-click="dn(5)">',"<strong>-5</strong>","</button>",'<button class="btn btn-mini" ng-click="dn(1)">',"-1","</button>",'<button class="btn btn-mini" ng-click="up(1)">',"+1","</button>",'<button class="btn btn-mini" ng-click="up(5)">',"<strong>+5</strong>","</button>","</div>"].join(""),replace:!0,scope:!0,link:function(e,t,n){if(!e.uiHistogramBins)return;e.$on("setupExtraAfter",function(){var n=e.views[0].margin;t.css("bottom",n.bottom+3+"px").css("left",n.left+3+"px")}),e.uiNBins=e[e.histogramBinsVar],e.$watch("histogramBinsVar",function(t,n){e.uiNBins=e[e.histogramBinsVar]}),e.up=function(t){e.uiNBins+=t,e.$parent[e.histogramBinsVar]=e.uiNBins},e.dn=function(t){e.uiNBins=Math.max(e.uiNBins-t,1),e.$parent[e.histogramBinsVar]=e.uiNBins}}}}),radian.factory("dft",function(){"use strict";return function(e,t){function n(e){t(e);for(var r=e.$$childHead;r;r=r.$$nextSibling)n(r)}n(e)}}),radian.factory("dftEsc",function(){"use strict";return function(e,t,n){function r(e,n){if(n&&!t(e))return;for(var i=e.$$childHead;i;i=i.$$nextSibling)r(i,!0)}r(e,n)}}),radian.factory("MD5",function(){return function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n=e&2147483648,r=t&2147483648,i=e&1073741824,s=t&1073741824,o=(e&1073741823)+(t&1073741823);return i&s?o^2147483648^n^r:i|s?o&1073741824?o^3221225472^n^r:o^1073741824^n^r:o^n^r}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function u(e,i,s,o,u,a,f){return e=n(e,n(n(r(i,s,o),u),f)),n(t(e,a),i)}function a(e,r,s,o,u,a,f){return e=n(e,n(n(i(r,s,o),u),f)),n(t(e,a),r)}function f(e,r,i,o,u,a,f){return e=n(e,n(n(s(r,i,o),u),f)),n(t(e,a),r)}function l(e,r,i,s,u,a,f){return e=n(e,n(n(o(r,i,s),u),f)),n(t(e,a),r)}function c(e){var t,n=e.length,r=n+8,i=(r-r%64)/64,s=(i+1)*16,o=Array(s-1),u=0,a=0;while(a<n)t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|e.charCodeAt(a)<<u,a++;return t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|128<<u,o[s-2]=n<<3,o[s-1]=n>>>29,o}function h(e){var t="",n="",r,i;for(i=0;i<=3;i++)r=e>>>i*8&255,n="0"+r.toString(16),t+=n.substr(n.length-2,2);return t}function p(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}var d=Array(),v,m,g,y,b,w,E,S,x,T=7,N=12,C=17,k=22,L=5,A=9,O=14,M=20,_=4,D=11,P=16,H=23,B=6,j=10,F=15,I=21;e=p(e),d=c(e),w=1732584193,E=4023233417,S=2562383102,x=271733878;for(v=0;v<d.length;v+=16)m=w,g=E,y=S,b=x,w=u(w,E,S,x,d[v+0],T,3614090360),x=u(x,w,E,S,d[v+1],N,3905402710),S=u(S,x,w,E,d[v+2],C,606105819),E=u(E,S,x,w,d[v+3],k,3250441966),w=u(w,E,S,x,d[v+4],T,4118548399),x=u(x,w,E,S,d[v+5],N,1200080426),S=u(S,x,w,E,d[v+6],C,2821735955),E=u(E,S,x,w,d[v+7],k,4249261313),w=u(w,E,S,x,d[v+8],T,1770035416),x=u(x,w,E,S,d[v+9],N,2336552879),S=u(S,x,w,E,d[v+10],C,4294925233),E=u(E,S,x,w,d[v+11],k,2304563134),w=u(w,E,S,x,d[v+12],T,1804603682),x=u(x,w,E,S,d[v+13],N,4254626195),S=u(S,x,w,E,d[v+14],C,2792965006),E=u(E,S,x,w,d[v+15],k,1236535329),w=a(w,E,S,x,d[v+1],L,4129170786),x=a(x,w,E,S,d[v+6],A,3225465664),S=a(S,x,w,E,d[v+11],O,643717713),E=a(E,S,x,w,d[v+0],M,3921069994),w=a(w,E,S,x,d[v+5],L,3593408605),x=a(x,w,E,S,d[v+10],A,38016083),S=a(S,x,w,E,d[v+15],O,3634488961),E=a(E,S,x,w,d[v+4],M,3889429448),w=a(w,E,S,x,d[v+9],L,568446438),x=a(x,w,E,S,d[v+14],A,3275163606),S=a(S,x,w,E,d[v+3],O,4107603335),E=a(E,S,x,w,d[v+8],M,1163531501),w=a(w,E,S,x,d[v+13],L,2850285829),x=a(x,w,E,S,d[v+2],A,4243563512),S=a(S,x,w,E,d[v+7],O,1735328473),E=a(E,S,x,w,d[v+12],M,2368359562),w=f(w,E,S,x,d[v+5],_,4294588738),x=f(x,w,E,S,d[v+8],D,2272392833),S=f(S,x,w,E,d[v+11],P,1839030562),E=f(E,S,x,w,d[v+14],H,4259657740),w=f(w,E,S,x,d[v+1],_,2763975236),x=f(x,w,E,S,d[v+4],D,1272893353),S=f(S,x,w,E,d[v+7],P,4139469664),E=f(E,S,x,w,d[v+10],H,3200236656),w=f(w,E,S,x,d[v+13],_,681279174),x=f(x,w,E,S,d[v+0],D,3936430074),S=f(S,x,w,E,d[v+3],P,3572445317),E=f(E,S,x,w,d[v+6],H,76029189),w=f(w,E,S,x,d[v+9],_,3654602809),x=f(x,w,E,S,d[v+12],D,3873151461),S=f(S,x,w,E,d[v+15],P,530742520),E=f(E,S,x,w,d[v+2],H,3299628645),w=l(w,E,S,x,d[v+0],B,4096336452),x=l(x,w,E,S,d[v+7],j,1126891415),S=l(S,x,w,E,d[v+14],F,2878612391),E=l(E,S,x,w,d[v+5],I,4237533241),w=l(w,E,S,x,d[v+12],B,1700485571),x=l(x,w,E,S,d[v+3],j,2399980690),S=l(S,x,w,E,d[v+10],F,4293915773),E=l(E,S,x,w,d[v+1],I,2240044497),w=l(w,E,S,x,d[v+8],B,1873313359),x=l(x,w,E,S,d[v+15],j,4264355552),S=l(S,x,w,E,d[v+6],F,2734768916),E=l(E,S,x,w,d[v+13],I,1309151649),w=l(w,E,S,x,d[v+4],B,4149444226),x=l(x,w,E,S,d[v+11],j,3174756917),S=l(S,x,w,E,d[v+2],F,718787259),E=l(E,S,x,w,d[v+9],I,3951481745),w=n(w,m),E=n(E,g),S=n(S,y),x=n(x,b);var q=h(w)+h(E)+h(S)+h(x);return q.toLowerCase()}}),radian.factory("dumpScope",function(){"use strict";var e=function(t,n){var r="";for(var i=0;i<n;++i)r=r.concat(" ");console.log(r+t.$id+": "+Object.keys(t).filter(function(e){return e.charAt(0)!="$"&&e!="this"}));for(var s=t.$$childHead;s;s=s.$$nextSibling)e(s,n+2)};return function(t){e(t,0)}});